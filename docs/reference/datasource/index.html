<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar class="astro-bguv2lll"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Data Source | TradeX Chart</title><link rel="canonical" href="https://tradex-app.github.io/TradeX-chart/reference/datasource/"/><link rel="sitemap" href="/TradeX-chart/sitemap-index.xml"/><link rel="shortcut icon" href="/TradeX-chart/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v3.3.0"/><meta name="generator" content="Starlight v0.11.1"/><meta property="og:title" content="Data Source"/><meta property="og:type" content="article"/><meta property="og:url" content="https://tradex-app.github.io/TradeX-chart/reference/datasource/"/><meta property="og:locale" content="en"/><meta property="og:description" content="Managing data flow for TradeX charts"/><meta property="og:site_name" content="TradeX Chart"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Data Source"/><meta name="twitter:description" content="Managing data flow for TradeX charts"/><meta name="description" content="Managing data flow for TradeX charts"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template><link rel="stylesheet" href="/TradeX-chart/astro/index.88731c60.css" />
<style>svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}
</style><script type="module" src="/TradeX-chart/astro/hoisted.5a2d23d0.js"></script></head><body class="astro-bguv2lll"><a href="#_top" class="astro-7q3lir66">Skip to content</a><div class="page sl-flex astro-vrdttmbt"><header class="header astro-vrdttmbt"><div class="header sl-flex astro-kmkmnagf"><div class="sl-flex astro-kmkmnagf"><a href="/TradeX-chart/" class="site-title sl-flex astro-m46x6ez3"><img class="astro-m46x6ez3" alt="" src="/TradeX-chart/astro/tx.82979636.svg" width="48" height="48"><span class="astro-m46x6ez3">TradeX Chart</span></a></div><div class="sl-flex astro-kmkmnagf"><site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-v37mnknz"><button data-open-modal disabled class="astro-v37mnknz"><svg aria-label="Search" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg><span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span><svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg></button><dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"><div class="dialog-frame sl-flex astro-v37mnknz"><button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz">Cancel</button><div class="search-container astro-v37mnknz"><div id="starlight__search" class="astro-v37mnknz"></div></div></div></dialog></site-search></div><div class="sl-hidden md:sl-flex right-group astro-kmkmnagf"><div class="sl-flex social-icons astro-kmkmnagf"><a href="https://github.com/tradex-app/TradeX-chart" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a><a href="https://discord.gg/hhfvuhJJY" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">Discord</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M20.32 4.37a19.8 19.8 0 0 0-4.93-1.51 13.78 13.78 0 0 0-.64 1.28 18.27 18.27 0 0 0-5.5 0 12.64 12.64 0 0 0-.64-1.28h-.05A19.74 19.74 0 0 0 3.64 4.4 20.26 20.26 0 0 0 .11 18.09l.02.02a19.9 19.9 0 0 0 6.04 3.03l.04-.02a14.24 14.24 0 0 0 1.23-2.03.08.08 0 0 0-.05-.07 13.1 13.1 0 0 1-1.9-.92.08.08 0 0 1 .02-.1 10.2 10.2 0 0 0 .41-.31h.04a14.2 14.2 0 0 0 12.1 0l.04.01a9.63 9.63 0 0 0 .4.32.08.08 0 0 1-.03.1 12.29 12.29 0 0 1-1.9.91.08.08 0 0 0-.02.1 15.97 15.97 0 0 0 1.27 2.01h.04a19.84 19.84 0 0 0 6.03-3.05v-.03a20.12 20.12 0 0 0-3.57-13.69ZM8.02 15.33c-1.18 0-2.16-1.08-2.16-2.42 0-1.33.96-2.42 2.16-2.42 1.21 0 2.18 1.1 2.16 2.42 0 1.34-.96 2.42-2.16 2.42Zm7.97 0c-1.18 0-2.15-1.08-2.15-2.42 0-1.33.95-2.42 2.15-2.42 1.22 0 2.18 1.1 2.16 2.42 0 1.34-.94 2.42-2.16 2.42Z"/></svg></a></div><starlight-theme-select><label style="--sl-select-width: 6.25em" class="astro-4yphtoen"><span class="sr-only astro-4yphtoen">Select theme</span><svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg><select value="auto" class="astro-4yphtoen"><option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected="true" class="astro-4yphtoen">Auto</option></select><svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg></label></starlight-theme-select><script>
	StarlightThemeProvider.updatePickers();
</script></div></div></header><nav class="sidebar astro-vrdttmbt" aria-label="Main"><starlight-menu-button class="astro-jif73yzw"><button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"><svg aria-hidden="true" class="astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg></button></starlight-menu-button><div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"><div class="sidebar-content sl-flex astro-vrdttmbt"><ul class="top-level astro-3ii7xxms"><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">Examples</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/01_static_chart/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Static Price History</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/02_live_history_chart/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Pice History with Live Price Feed</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/custom_indicator/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Indicator</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/custom-drawing-tools/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Drawing Tools</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/custom-theme-builder/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Theme Builder</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/export-chart-image/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Export Chart Image</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/features/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Chart Features</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/indicator-alerts/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Indicator Alerts</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/mobile-responsive/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Mobile Responsive</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/multi-chart-sync/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Multi-Chart Synchronization</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/real-time-websocket/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Real-Time WebSocket</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/examples/static_chart/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Static Price History</span></a></li></ul></details></li><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">Guides</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">backend</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/backend/data-caching-strategies/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Data Caching Strategies</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/backend/graphql-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">GraphQL Integration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/backend/rest-api-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">REST API Integration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/backend/websocket-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">WebSocket Integration</span></a></li></ul></details></li><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">deployment</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/deployment/cdn-deployment/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">CDN Deployment</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/deployment/production-checklist/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Production Checklist</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/deployment/security-considerations/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Security Considerations</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/deployment/vite-config/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Vite Configuration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/deployment/webpack-config/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Webpack Configuration</span></a></li></ul></details></li><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">development</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/development/build-process/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Build Process</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/development/contributing-code/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Contributing Code</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/development/debugging-tips/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Debugging Tips</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/development/local-setup/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Local Development Setup</span></a></li></ul></details></li><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">framework-integration</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/framework-integration/angular-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Angular Integration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/framework-integration/nextjs-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Next.js Integration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/framework-integration/react-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">React Integration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/framework-integration/svelte-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Svelte Integration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/framework-integration/vue-integration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Vue Integration</span></a></li></ul></details></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/accessibility/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Accessibility</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/comparison/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Library Comparison</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/contributing/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Contributing to TradeX Chart</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/custom_indicator/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Indicator - How to Build and Use</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/data-management/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Data Management</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/faq/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Frequently Asked Questions</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/howto/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">How To</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/i18n/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Internationalization (i18n)</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/known_bugs_issues/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Known Bugs Issues and Fixes</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/performance/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Performance Optimization</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/repurpose_indicators/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Repurpose Indicators</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/test/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Test</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/testing/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Testing</span></a></li><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">recipes</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/recipes/add-custom-buttons/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Add Custom Buttons</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/recipes/change-colors-dynamically/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Change Colors Dynamically</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/recipes/custom-tooltips/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Tooltips</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/recipes/keyboard-shortcuts/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Keyboard Shortcuts</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/recipes/multi-language-support/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Multi-Language Support</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/guides/recipes/save-restore-chart-state/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Save &amp; Restore Chart State</span></a></li></ul></details></li></ul></details></li><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">Reference</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Introduction</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/00_introduction/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Introduction</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/01_getting_started/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Getting Started</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/02_configuration/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Configuration</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/annotations/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Annotations</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/api-examples/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">API Examples</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/architecture/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Architecture</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/canvas_extension_layers/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Canvas Extension Layers</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/canvas_methods/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Canvas Methods</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/changelog/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Changelog</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/datasource/" aria-current="page" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Data Source</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/events/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Events</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/example/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Example Reference</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/glossary/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Glossary</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/hit_detection/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Hit Detection</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/indicators/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Indicators</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/indicators_custom/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Indicators</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/indicators_default/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Default Indicators</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/indicators_talib/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">TA-Lib Functions</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/legends/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Legends</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/overlays/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Overlays</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/overlays_custom/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Overlays</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/overlays_news_events/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Overlay News Events</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/overlays_trades/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Overlay Trades</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/range/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Range</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/state/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">State</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/state_machine/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">State Machine</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/streaming_price_data/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Streaming Price Data to the Chart</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/themes/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Themes</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/web_workers/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Web Workers</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/reference/widgets/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Widgets</span></a></li></ul></details></li><li class="astro-3ii7xxms"><details open class="astro-3ii7xxms"><summary class="astro-3ii7xxms"><span class="large astro-3ii7xxms">API</span><svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></summary><ul class="astro-3ii7xxms"><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/core/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">core</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/core-old/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">core - documentation.js</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/core2/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">core</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/custom-drawing-tools/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Drawing Tools API</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/custom-theme-builder/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Custom Theme Builder API</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/export-chart-image/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Export Chart Image API</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/indicator-alerts/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Indicator Alerts API</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/mobile-responsive/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Mobile Responsive API</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/multi-chart-sync/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Multi-Chart Sync API</span></a></li><li class="astro-3ii7xxms"><a href="/TradeX-chart/api/real-time-websocket/" class="astro-3ii7xxms"><span class="astro-3ii7xxms">Real-Time WebSocket API</span></a></li></ul></details></li></ul><div class="md:sl-hidden"><div class="mobile-preferences sl-flex astro-wu23bvmt"><starlight-theme-select><label style="--sl-select-width: 6.25em" class="astro-4yphtoen"><span class="sr-only astro-4yphtoen">Select theme</span><svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg><select value="auto" class="astro-4yphtoen"><option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected="true" class="astro-4yphtoen">Auto</option></select><svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg></label></starlight-theme-select><script>
	StarlightThemeProvider.updatePickers();
</script></div></div></div></div></nav><div class="main-frame astro-vrdttmbt"><div class="lg:sl-flex astro-67yu43on"><aside class="right-sidebar-container astro-67yu43on"><div class="right-sidebar astro-67yu43on"><div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="4" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><div class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></div><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"><li class="astro-g2bywc46" style="--depth: 0;"><a href="#_top" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Overview</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#overview" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Overview</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#static-properties" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Static Properties</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#time-constants" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Time Constants</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#default-time-frames" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Default Time Frames</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#static-methods" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Static Methods</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#createcfg-state" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">create(cfg, state)</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#deletekey-haskey-getkey" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">delete(key), has(key), get(key)</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#listchart" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">list(chart)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#constructor" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Constructor</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#properties" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Properties</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#getters" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Getters</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#setters" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Setters</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#core-methods" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Core Methods</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#symbol-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Symbol Management</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#symbolsetsymbol" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">symbolSet(symbol)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#symbolsaddsymbols" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">symbolsAdd(symbols)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#time-frame-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Time Frame Management</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframeusetf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrameUse(tf)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframevalidatetf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrameValidate(tf)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframeexiststf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrameExists(tf)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#ticker-stream-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Ticker Stream Management</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tickeraddticker-begin" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">tickerAdd(ticker, begin)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tickerstartsymbol-tf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">tickerStart(symbol, tf)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tickerstop" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">tickerStop()</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#historical-data-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Historical Data Management</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#historyaddhistory" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">historyAdd(history)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#starttickerhistoryconfig" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">startTickerHistory(config)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#onrangelimitevent-fn-timestamp" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">onRangeLimit(event, fn, timestamp)</span></a></li></ul></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#state-management" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">State Management</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#findmatchingstatesource-symbol-timeframe" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">findMatchingState(source, symbol, timeFrame)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#usage-example" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Usage Example</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#error-handling" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Error Handling</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#events" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Events</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#internal-architecture" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Internal Architecture</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#private-properties" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Private Properties</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#static-registry" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Static Registry</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#advanced-features" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Advanced Features</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#multi-state-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Multi-State Management</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#stream-integration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Stream Integration</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#range-based-data-loading" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Range-Based Data Loading</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#data-flow-architecture" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Data Flow Architecture</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#pull-based-design" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Pull-Based Design</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#state-synchronization" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">State Synchronization</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#configuration-options" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Configuration Options</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#source-configuration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Source Configuration</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#symbol-configuration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Symbol Configuration</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#timeframe-configuration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">TimeFrame Configuration</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#error-scenarios-and-handling" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Error Scenarios and Handling</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#common-error-cases" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Common Error Cases</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#recovery-mechanisms" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Recovery Mechanisms</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#performance-considerations" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Performance Considerations</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#memory-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Memory Management</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#efficient-state-switching" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Efficient State Switching</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#stream-optimization" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Stream Optimization</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#integration-examples" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Integration Examples</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#basic-setup" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Basic Setup</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#advanced-setup-with-custom-data-provider" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Advanced Setup with Custom Data Provider</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#multiple-timeframe-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Multiple TimeFrame Management</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#testing-and-debugging" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Testing and Debugging</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#debug-information" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Debug Information</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#mock-data-provider-for-testing" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Mock Data Provider for Testing</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#migration-and-compatibility" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Migration and Compatibility</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#upgrading-from-previous-versions" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Upgrading from Previous Versions</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#backward-compatibility" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Backward Compatibility</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#best-practices" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Best Practices</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#1-resource-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">1. Resource Management</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#2-error-handling" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">2. Error Handling</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#3-performance-optimization" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">3. Performance Optimization</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#4-state-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">4. State Management</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#api-reference" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">API Reference</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#utility-functions" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Utility Functions</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#consoleerrorcore-key-error" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">consoleError(core, key, error)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#throwerrorid-key-error" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">throwError(id, key, error)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#buildtimeframestimeframes" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">buildTimeFrames(timeframes)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframe2mstimeframe" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrame2MS(timeframe)</span></a></li></ul></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#event-system-integration" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Event System Integration</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#core-events" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Core Events</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#custom-event-handlers" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Custom Event Handlers</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#data-formats" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Data Formats</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#expected-data-structure" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Expected Data Structure</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#candle-data-format" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">Candle Data Format</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tick-data-format" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">Tick Data Format</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#volume-data-format" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">Volume Data Format</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#data-validation" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Data Validation</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#websocket-integration" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">WebSocket Integration</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#real-time-data-streaming" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Real-time Data Streaming</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#connection-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Connection Management</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#caching-strategies" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Caching Strategies</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#memory-based-caching" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Memory-Based Caching</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#persistent-caching" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Persistent Caching</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#advanced-configuration" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Advanced Configuration</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#multi-exchange-setup" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Multi-Exchange Setup</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#aggregated-data-sources" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Aggregated Data Sources</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#performance-monitoring" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Performance Monitoring</span></a><ul class="isMobile astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#metrics-collection" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Metrics Collection</span></a></li></ul></li></ul></div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="4"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"><li class="astro-g2bywc46" style="--depth: 0;"><a href="#_top" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Overview</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#overview" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Overview</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#static-properties" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Static Properties</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#time-constants" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Time Constants</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#default-time-frames" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Default Time Frames</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#static-methods" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Static Methods</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#createcfg-state" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">create(cfg, state)</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#deletekey-haskey-getkey" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">delete(key), has(key), get(key)</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#listchart" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">list(chart)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#constructor" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Constructor</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#properties" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Properties</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#getters" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Getters</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#setters" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Setters</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#core-methods" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Core Methods</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#symbol-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Symbol Management</span></a><ul class="astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#symbolsetsymbol" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">symbolSet(symbol)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#symbolsaddsymbols" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">symbolsAdd(symbols)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#time-frame-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Time Frame Management</span></a><ul class="astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframeusetf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrameUse(tf)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframevalidatetf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrameValidate(tf)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframeexiststf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrameExists(tf)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#ticker-stream-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Ticker Stream Management</span></a><ul class="astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tickeraddticker-begin" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">tickerAdd(ticker, begin)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tickerstartsymbol-tf" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">tickerStart(symbol, tf)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tickerstop" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">tickerStop()</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#historical-data-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Historical Data Management</span></a><ul class="astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#historyaddhistory" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">historyAdd(history)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#starttickerhistoryconfig" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">startTickerHistory(config)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#onrangelimitevent-fn-timestamp" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">onRangeLimit(event, fn, timestamp)</span></a></li></ul></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#state-management" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">State Management</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#findmatchingstatesource-symbol-timeframe" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">findMatchingState(source, symbol, timeFrame)</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#usage-example" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Usage Example</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#error-handling" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Error Handling</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#events" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Events</span></a></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#internal-architecture" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Internal Architecture</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#private-properties" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Private Properties</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#static-registry" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Static Registry</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#advanced-features" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Advanced Features</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#multi-state-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Multi-State Management</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#stream-integration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Stream Integration</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#range-based-data-loading" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Range-Based Data Loading</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#data-flow-architecture" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Data Flow Architecture</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#pull-based-design" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Pull-Based Design</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#state-synchronization" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">State Synchronization</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#configuration-options" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Configuration Options</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#source-configuration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Source Configuration</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#symbol-configuration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Symbol Configuration</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#timeframe-configuration" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">TimeFrame Configuration</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#error-scenarios-and-handling" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Error Scenarios and Handling</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#common-error-cases" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Common Error Cases</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#recovery-mechanisms" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Recovery Mechanisms</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#performance-considerations" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Performance Considerations</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#memory-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Memory Management</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#efficient-state-switching" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Efficient State Switching</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#stream-optimization" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Stream Optimization</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#integration-examples" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Integration Examples</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#basic-setup" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Basic Setup</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#advanced-setup-with-custom-data-provider" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Advanced Setup with Custom Data Provider</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#multiple-timeframe-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Multiple TimeFrame Management</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#testing-and-debugging" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Testing and Debugging</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#debug-information" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Debug Information</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#mock-data-provider-for-testing" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Mock Data Provider for Testing</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#migration-and-compatibility" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Migration and Compatibility</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#upgrading-from-previous-versions" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Upgrading from Previous Versions</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#backward-compatibility" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Backward Compatibility</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#best-practices" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Best Practices</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#1-resource-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">1. Resource Management</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#2-error-handling" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">2. Error Handling</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#3-performance-optimization" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">3. Performance Optimization</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#4-state-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">4. State Management</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#api-reference" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">API Reference</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#utility-functions" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Utility Functions</span></a><ul class="astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#consoleerrorcore-key-error" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">consoleError(core, key, error)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#throwerrorid-key-error" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">throwError(id, key, error)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#buildtimeframestimeframes" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">buildTimeFrames(timeframes)</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#timeframe2mstimeframe" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">timeFrame2MS(timeframe)</span></a></li></ul></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#event-system-integration" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Event System Integration</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#core-events" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Core Events</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#custom-event-handlers" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Custom Event Handlers</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#data-formats" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Data Formats</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#expected-data-structure" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Expected Data Structure</span></a><ul class="astro-g2bywc46" style="--depth: 2;"><li class="astro-g2bywc46" style="--depth: 2;"><a href="#candle-data-format" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">Candle Data Format</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#tick-data-format" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">Tick Data Format</span></a></li><li class="astro-g2bywc46" style="--depth: 2;"><a href="#volume-data-format" class="astro-g2bywc46" style="--depth: 2;"><span class="astro-g2bywc46" style="--depth: 2;">Volume Data Format</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#data-validation" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Data Validation</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#websocket-integration" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">WebSocket Integration</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#real-time-data-streaming" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Real-time Data Streaming</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#connection-management" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Connection Management</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#caching-strategies" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Caching Strategies</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#memory-based-caching" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Memory-Based Caching</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#persistent-caching" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Persistent Caching</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#advanced-configuration" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Advanced Configuration</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#multi-exchange-setup" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Multi-Exchange Setup</span></a></li><li class="astro-g2bywc46" style="--depth: 1;"><a href="#aggregated-data-sources" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Aggregated Data Sources</span></a></li></ul></li><li class="astro-g2bywc46" style="--depth: 0;"><a href="#performance-monitoring" class="astro-g2bywc46" style="--depth: 0;"><span class="astro-g2bywc46" style="--depth: 0;">Performance Monitoring</span></a><ul class="astro-g2bywc46" style="--depth: 1;"><li class="astro-g2bywc46" style="--depth: 1;"><a href="#metrics-collection" class="astro-g2bywc46" style="--depth: 1;"><span class="astro-g2bywc46" style="--depth: 1;">Metrics Collection</span></a></li></ul></li></ul></nav></starlight-toc></div></div></div></aside><div class="main-pane astro-67yu43on"><main data-pagefind-body lang="en" dir="ltr" class="astro-bguv2lll"><div class="content-panel astro-7nkwcw3z"><div class="sl-container astro-7nkwcw3z"><h1 id="_top" class="astro-j6tvhyss">Data Source</h1></div></div><div class="content-panel astro-7nkwcw3z"><div class="sl-container astro-7nkwcw3z"><div class="content astro-ml6ntd6l"><p>The <code dir="auto">DataSource</code> class manages data flow for TradeX charts in an agnostic manner, implementing a pull-based architecture where charts request data rather than having data pushed to them.</p>
<h2 id="overview">Overview</h2>
<p>DataSource handles:</p>
<ul>
<li>Symbol and timeframe management</li>
<li>Real-time ticker streams</li>
<li>Historical data fetching</li>
<li>State management across different chart configurations</li>
<li>Data source registry and lifecycle management</li>
</ul>
<h2 id="static-properties">Static Properties</h2>
<h3 id="time-constants">Time Constants</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> SECOND_MS</span><span style="color:#F97583"> =</span><span style="color:#F8F8F8"> 1000</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> MINUTE_MS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> SECOND_MS</span><span style="color:#F97583"> *</span><span style="color:#F8F8F8"> 60</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> HOUR_MS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> MINUTE_MS</span><span style="color:#F97583"> *</span><span style="color:#F8F8F8"> 60</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> DAY_MS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> HOUR_MS</span><span style="color:#F97583"> *</span><span style="color:#F8F8F8"> 24</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> WEEK_MS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DAY_MS</span><span style="color:#F97583"> *</span><span style="color:#F8F8F8"> 7</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> MONTHR_MS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DAY_MS</span><span style="color:#F97583"> *</span><span style="color:#F8F8F8"> 30</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> YEAR_MS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DAY_MS</span><span style="color:#F97583"> *</span><span style="color:#F8F8F8"> 365</span></span></code></pre>
<h3 id="default-time-frames">Default Time Frames</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#B392F0">static get defaultTimeFrames()</span></span></code></pre>
<p>Returns the default supported timeframes:</p>
<ul>
<li>Minutes: 1m, 2m, 3m, 5m, 10m, 15m, 30m</li>
<li>Hours: 1h, 2h, 3h, 4h</li>
<li>Days: 1d</li>
<li>Weeks: 1w</li>
<li>Months: 1M, 3M, 6M</li>
<li>Years: 1y</li>
</ul>
<h2 id="static-methods">Static Methods</h2>
<h3 id="createcfg-state">create(cfg, state)</h3>
<p>Creates a new DataSource instance and registers it.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">cfg</code> (Object) - Configuration object
<ul>
<li><code dir="auto">symbol</code> (String) - Trading pair symbol (e.g., “BTC/USDT”)</li>
<li><code dir="auto">timeFrames</code> (Array<number>) - Supported timeframes in milliseconds</number></li>
<li><code dir="auto">timeFrameInit</code> (Number) - Initial timeframe</li>
<li><code dir="auto">ticker</code> (Object) - Ticker stream configuration</li>
<li><code dir="auto">history</code> (Object) - Historical data configuration</li>
</ul>
</li>
<li><code dir="auto">state</code> (State) - Chart state instance</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">DataSource</code> instance or <code dir="auto">undefined</code> if creation fails</p>
<h3 id="deletekey-haskey-getkey">delete(key), has(key), get(key)</h3>
<p>Registry management methods for DataSource instances.</p>
<h3 id="listchart">list(chart)</h3>
<p>Lists all registered data sources for a given chart.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">chart</code> (TradeXchart) - Target chart instance</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">Array&#x3C;DataSource></code> or <code dir="auto">undefined</code></p>
<h2 id="constructor">Constructor</h2>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#B392F0">constructor(cfg</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state)</span></span></code></pre>
<p>Creates a DataSource instance for a specific symbol and state.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">cfg</code> (Object) - Configuration object
<ul>
<li><code dir="auto">source</code> (Object) - Exchange or data provider configuration</li>
<li><code dir="auto">symbol</code> (String) - Trading pair symbol</li>
<li><code dir="auto">symbols</code> (Object) - List of symbols and their data</li>
<li><code dir="auto">timeFrames</code> (Array<number>) - Supported timeframes</number></li>
<li><code dir="auto">timeFrameInit</code> (Number) - Initial timeframe</li>
<li><code dir="auto">ticker</code> (Ticker) - Ticker stream handler</li>
<li><code dir="auto">history</code> (History) - Historical data handler</li>
<li><code dir="auto">initialRange</code> (Object) - Initial chart range configuration</li>
</ul>
</li>
<li><code dir="auto">state</code> (State) - Chart state instance</li>
</ul>
<h2 id="properties">Properties</h2>
<h3 id="getters">Getters</h3>
<ul>
<li><code dir="auto">id</code> - Unique DataSource identifier</li>
<li><code dir="auto">cfg</code> - Configuration object</li>
<li><code dir="auto">state</code> - Associated chart state</li>
<li><code dir="auto">source</code> - Data source configuration</li>
<li><code dir="auto">stream</code> - Stream handler instance</li>
<li><code dir="auto">symbol</code> - Current trading symbol</li>
<li><code dir="auto">timeFrame</code> / <code dir="auto">timeFrameMS</code> - Current timeframe in milliseconds</li>
<li><code dir="auto">timeFrameStr</code> - Current timeframe as string (e.g., “1h”)</li>
<li><code dir="auto">timeFrames</code> - Available timeframes</li>
<li><code dir="auto">range</code> - Chart range handler</li>
</ul>
<h3 id="setters">Setters</h3>
<ul>
<li><code dir="auto">timeFrame</code> - Sets the current timeframe</li>
</ul>
<h2 id="core-methods">Core Methods</h2>
<h3 id="symbol-management">Symbol Management</h3>
<h4 id="symbolsetsymbol">symbolSet(symbol)</h4>
<p>Sets the trading symbol for the data source.</p>
<h4 id="symbolsaddsymbols">symbolsAdd(symbols)</h4>
<p>Adds multiple symbols to the data source.</p>
<h3 id="time-frame-management">Time Frame Management</h3>
<h4 id="timeframeusetf">timeFrameUse(tf)</h4>
<p>Sets the chart timeframe and manages state transitions.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">tf</code> (Number|String) - Timeframe in milliseconds or string format (e.g., “1h”)</li>
</ul>
<h4 id="timeframevalidatetf">timeFrameValidate(tf)</h4>
<p>Validates a timeframe value.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">tf</code> (Number|String) - Timeframe to validate</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">Number</code> - Validated timeframe in milliseconds, or <code dir="auto">undefined</code> if invalid</p>
<h4 id="timeframeexiststf">timeFrameExists(tf)</h4>
<p>Checks if a timeframe is supported.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">tf</code> (Number|String) - Timeframe to check</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">Number</code> - Timeframe in milliseconds if exists, <code dir="auto">undefined</code> otherwise</p>
<h3 id="ticker-stream-management">Ticker Stream Management</h3>
<h4 id="tickeraddticker-begin">tickerAdd(ticker, begin)</h4>
<p>Adds a ticker stream to the chart.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">ticker</code> (Object) - Ticker stream definition
<ul>
<li><code dir="auto">start</code> (Function) - Function to start the stream</li>
<li><code dir="auto">stop</code> (Function) - Function to stop the stream</li>
</ul>
</li>
<li><code dir="auto">begin</code> (Object) - Optional auto-start configuration
<ul>
<li><code dir="auto">symbol</code> (String) - Ticker symbol</li>
<li><code dir="auto">tf</code> (Number) - Timeframe in milliseconds</li>
</ul>
</li>
</ul>
<h4 id="tickerstartsymbol-tf">tickerStart(symbol, tf)</h4>
<p>Starts the ticker stream for a specific symbol and timeframe.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">symbol</code> (String) - Trading symbol</li>
<li><code dir="auto">tf</code> (Number|String) - Timeframe</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">Boolean</code> - Success status</p>
<h4 id="tickerstop">tickerStop()</h4>
<p>Stops the current ticker stream.</p>
<h3 id="historical-data-management">Historical Data Management</h3>
<h4 id="historyaddhistory">historyAdd(history)</h4>
<p>Adds historical data fetching functions.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">history</code> (Object) - History configuration
<ul>
<li><code dir="auto">rangeLimitPast</code> (Function) - Fetch function for past data</li>
<li><code dir="auto">rangeLimitFuture</code> (Function) - Fetch function for future data</li>
</ul>
</li>
</ul>
<p>Both functions must accept 4 parameters and return a Promise.</p>
<h4 id="starttickerhistoryconfig">startTickerHistory(config)</h4>
<p>Starts both ticker stream and loads initial historical data.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">config</code> (Object) - Combined configuration
<ul>
<li><code dir="auto">rangeLimitPast</code> (Function) - Historical data fetch function</li>
<li><code dir="auto">rangeLimitFuture</code> (Function) - Future data fetch function (optional)</li>
<li><code dir="auto">start</code> (Function) - Ticker start function</li>
<li><code dir="auto">stop</code> (Function) - Ticker stop function</li>
<li><code dir="auto">symbol</code> (String) - Trading symbol</li>
<li><code dir="auto">tf</code> (Number) - Timeframe in milliseconds</li>
</ul>
</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">Boolean</code> - Success status</p>
<h4 id="onrangelimitevent-fn-timestamp">onRangeLimit(event, fn, timestamp)</h4>
<p>Executes data fetching when chart range limits are reached.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">event</code> - Range limit event</li>
<li><code dir="auto">fn</code> (Function) - Fetch function to execute</li>
<li><code dir="auto">timestamp</code> (Number) - Unix timestamp in milliseconds</li>
</ul>
<h2 id="state-management">State Management</h2>
<h4 id="findmatchingstatesource-symbol-timeframe">findMatchingState(source, symbol, timeFrame)</h4>
<p>Finds existing states that match the given criteria.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">source</code> (String) - Data source name (optional, defaults to current)</li>
<li><code dir="auto">symbol</code> (String) - Trading symbol (optional, defaults to current)</li>
<li><code dir="auto">timeFrame</code> (Number) - Timeframe (optional, defaults to current)</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">State|Object|undefined</code> - Exact match, closest matches, or undefined</p>
<h2 id="usage-example">Usage Example</h2>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> DataSource </span><span style="color:#F97583">from</span><span style="color:#FFAB70"> './dataSource.js'</span><span style="color:#B392F0">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Create a data source</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> config</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // 1 hour</span></span>
<span class="line"><span style="color:#B392F0">  source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    name</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'binance'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">    rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> (event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">      // Fetch historical data</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetchHistoricalData(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create(config</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> chartState);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Start real-time data</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.startTickerHistory({</span></span>
<span class="line"><span style="color:#B392F0">  symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  tf</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#B392F0"> fetchHistoricalData</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  start</span><span style="color:#F97583">:</span><span style="color:#B392F0"> startTickerStream</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  stop</span><span style="color:#F97583">:</span><span style="color:#B392F0"> stopTickerStream</span></span>
<span class="line"><span style="color:#B392F0">});</span></span></code></pre>
<h2 id="error-handling">Error Handling</h2>
<p>The DataSource class includes comprehensive error handling:</p>
<ul>
<li>Parameter validation for all public methods</li>
<li>Promise rejection handling for async operations</li>
<li>Graceful fallbacks for missing configurations</li>
<li>Detailed error messages with context information</li>
</ul>
<h2 id="events">Events</h2>
<p>DataSource integrates with the chart’s event system:</p>
<ul>
<li><code dir="auto">range_limitPast</code> - Triggered when more historical data is needed</li>
<li><code dir="auto">range_limitFuture</code> - Triggered when future data is requested</li>
<li><code dir="auto">stream_candleFirst</code> - Triggered when first real-time candle arrives</li>
</ul>
<h2 id="internal-architecture">Internal Architecture</h2>
<h3 id="private-properties">Private Properties</h3>
<p>The DataSource class uses private fields to encapsulate internal state:</p>
<ul>
<li><code dir="auto">#cnt</code> - Instance counter</li>
<li><code dir="auto">#id</code> - Unique identifier</li>
<li><code dir="auto">#core</code> - Reference to TradeXchart core</li>
<li><code dir="auto">#cfg</code> - Configuration object</li>
<li><code dir="auto">#source</code> - Data source configuration</li>
<li><code dir="auto">#symbol</code> - Current trading symbol</li>
<li><code dir="auto">#state</code> - Associated chart state</li>
<li><code dir="auto">#range</code> - Range management instance</li>
<li><code dir="auto">#stream</code> - Stream handler</li>
<li><code dir="auto">#timeFrames</code> - Available timeframes map</li>
<li><code dir="auto">#timeFrameCurr</code> - Current active timeframe</li>
<li><code dir="auto">#waiting</code> - Flag for pending data requests</li>
<li><code dir="auto">#fetching</code> - Flag for active fetch operations</li>
</ul>
<h3 id="static-registry">Static Registry</h3>
<p>DataSource maintains static registries for tracking instances:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#B392F0">static #chartList </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> xMap()    </span><span style="color:#6B737C">// Chart to DataSource mapping</span></span>
<span class="line"><span style="color:#B392F0">static #sourceList </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> xMap()   </span><span style="color:#6B737C">// DataSource to State mapping</span></span>
<span class="line"><span style="color:#B392F0">static #sourceCnt </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 0</span><span style="color:#6B737C">             // Global instance counter</span></span></code></pre>
<h2 id="advanced-features">Advanced Features</h2>
<h3 id="multi-state-management">Multi-State Management</h3>
<p>DataSource can manage multiple chart states for the same symbol with different timeframes:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Switch between timeframes</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrame </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> '5m'</span><span style="color:#B392F0">;  </span><span style="color:#6B737C">// Automatically manages state transitions</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrame </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> '1h'</span><span style="color:#B392F0">;  </span><span style="color:#6B737C">// Creates new state or switches to existing one</span></span></code></pre>
<h3 id="stream-integration">Stream Integration</h3>
<p>The DataSource integrates with the Stream class for real-time data:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Stream lifecycle management</span></span>
<span class="line"><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#stream</span><span style="color:#B392F0">.start();           </span><span style="color:#6B737C">// Start processing real-time data</span></span>
<span class="line"><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#stream</span><span style="color:#B392F0">.onTick(tickData);  </span><span style="color:#6B737C">// Process incoming tick data</span></span>
<span class="line"><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#stream</span><span style="color:#B392F0">.stop();            </span><span style="color:#6B737C">// Stop stream processing</span></span></code></pre>
<h3 id="range-based-data-loading">Range-Based Data Loading</h3>
<p>Automatic data loading based on chart viewport:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Past data loading</span></span>
<span class="line"><span style="color:#79B8FF">core</span><span style="color:#B392F0">.on(</span><span style="color:#FFAB70">'range_limitPast'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> (event) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">  // Automatically triggered when user scrolls to chart beginning</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> fetchHistoricalData(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> event</span><span style="color:#B392F0">.startTS);</span></span>
<span class="line"><span style="color:#B392F0">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Future data loading  </span></span>
<span class="line"><span style="color:#79B8FF">core</span><span style="color:#B392F0">.on(</span><span style="color:#FFAB70">'range_limitFuture'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> (event) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">  // Triggered when scrolling beyond available data</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> fetchFutureData(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> event</span><span style="color:#B392F0">.endTS);</span></span>
<span class="line"><span style="color:#B392F0">});</span></span></code></pre>
<h2 id="data-flow-architecture">Data Flow Architecture</h2>
<h3 id="pull-based-design">Pull-Based Design</h3>
<p>Unlike traditional push-based systems, DataSource implements a pull architecture:</p>
<ol>
<li><strong>Chart Request</strong>: Chart requests data for specific range/timeframe</li>
<li><strong>DataSource Evaluation</strong>: DataSource checks cache and determines data needs</li>
<li><strong>Data Fetching</strong>: External data sources are queried as needed</li>
<li><strong>State Update</strong>: Retrieved data is merged into appropriate chart state</li>
<li><strong>Chart Notification</strong>: Chart is notified of data availability</li>
</ol>
<h3 id="state-synchronization">State Synchronization</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Automatic state management</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> matchingState</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.findMatchingState(</span><span style="color:#FFAB70">'binance'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1h'</span><span style="color:#B392F0">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#B392F0"> (matchingState </span><span style="color:#F97583">instanceof</span><span style="color:#B392F0"> State) {</span></span>
<span class="line"><span style="color:#6B737C">  // Switch to existing state</span></span>
<span class="line"><span style="color:#79B8FF">  this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#state</span><span style="color:#B392F0">.use(</span><span style="color:#79B8FF">matchingState</span><span style="color:#B392F0">.key);</span></span>
<span class="line"><span style="color:#B392F0">} </span><span style="color:#F97583">else</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">  // Create new state with current configuration</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> newStateDef</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    dataSource</span><span style="color:#F97583">:</span><span style="color:#B392F0"> doStructuredClone(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#state</span><span style="color:#B392F0">.dataSource)</span></span>
<span class="line"><span style="color:#B392F0">  };</span></span>
<span class="line"><span style="color:#79B8FF">  this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#state</span><span style="color:#B392F0">.use(newStateDef);</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h2 id="configuration-options">Configuration Options</h2>
<h3 id="source-configuration">Source Configuration</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> sourceConfig</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  name</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'binance'</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C">                    // Data provider identifier</span></span>
<span class="line"><span style="color:#B392F0">  tickerStream</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    start</span><span style="color:#F97583">:</span><span style="color:#B392F0"> startStreamFunction</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C">       // WebSocket connection starter</span></span>
<span class="line"><span style="color:#B392F0">    stop</span><span style="color:#F97583">:</span><span style="color:#B392F0"> stopStreamFunction          </span><span style="color:#6B737C">// WebSocket connection closer</span></span>
<span class="line"><span style="color:#B392F0">  }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#B392F0"> fetchPastData</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C">      // Historical data fetcher</span></span>
<span class="line"><span style="color:#B392F0">  rangeLimitFuture</span><span style="color:#F97583">:</span><span style="color:#B392F0"> fetchFutureData   </span><span style="color:#6B737C">// Future data fetcher (optional)</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h3 id="symbol-configuration">Symbol Configuration</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> symbolConfig</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C">                 // Primary trading pair</span></span>
<span class="line"><span style="color:#B392F0">  symbols</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {                          </span><span style="color:#6B737C">// Additional symbol data</span></span>
<span class="line"><span style="color:#FFAB70">    'BTC/USDT'</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { precision</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 8</span><span style="color:#B392F0"> }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#FFAB70">    'ETH/USDT'</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { precision</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 6</span><span style="color:#B392F0"> }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h3 id="timeframe-configuration">TimeFrame Configuration</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> timeFrameConfig</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  timeFrames</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [</span><span style="color:#F8F8F8">60000</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 300000</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // Custom timeframes in ms</span></span>
<span class="line"><span style="color:#B392F0">  timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#6B737C">                 // Initial timeframe</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h2 id="error-scenarios-and-handling">Error Scenarios and Handling</h2>
<h3 id="common-error-cases">Common Error Cases</h3>
<ol>
<li>
<p><strong>Invalid Symbol</strong>:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Throws error if symbol is invalid or empty</span></span>
<span class="line"><span style="color:#B392F0">throwError(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#core</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">ID</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#state</span><span style="color:#B392F0">.key</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> 'symbol invalid'</span><span style="color:#B392F0">);</span></span></code></pre>
</li>
<li>
<p><strong>Invalid TimeFrame</strong>:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Validates timeframe before use</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#B392F0">isInteger(tf)) {</span></span>
<span class="line"><span style="color:#B392F0">  throwError(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#core</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">ID</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#state</span><span style="color:#B392F0">.key</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> 'time frame invalid'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
</li>
<li>
<p><strong>Function Parameter Mismatch</strong>:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Validates function signatures</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">rangeLimitPast</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> !==</span><span style="color:#F8F8F8"> 4</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#B392F0">  consoleError(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.#core</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#state</span><span style="color:#B392F0">.key</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> </span></span>
<span class="line"><span style="color:#FFAB70">    'rangeLimitPast function requires 4 parameters'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
</li>
<li>
<p><strong>Promise Rejection Handling</strong>:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">promise</span><span style="color:#B392F0">.catch(error </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">  this</span><span style="color:#B392F0">.#waiting </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#79B8FF">  this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#core</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">progress</span><span style="color:#B392F0">.stop();</span></span>
<span class="line"><span style="color:#79B8FF">  this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#core</span><span style="color:#B392F0">.error(error);</span></span>
<span class="line"><span style="color:#B392F0">});</span></span></code></pre>
</li>
</ol>
<h3 id="recovery-mechanisms">Recovery Mechanisms</h3>
<ul>
<li><strong>Automatic Retry</strong>: Failed data requests can be automatically retried</li>
<li><strong>Fallback States</strong>: System falls back to previous working state on errors</li>
<li><strong>Progress Indicators</strong>: Loading states are properly managed and cleaned up</li>
<li><strong>Resource Cleanup</strong>: Streams and event listeners are properly disposed</li>
</ul>
<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="memory-management">Memory Management</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Proper cleanup on DataSource deletion</span></span>
<span class="line"><span style="color:#B392F0">static </span><span style="color:#F97583">delete</span><span style="color:#B392F0">(key) {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#B392F0"> (key </span><span style="color:#F97583">instanceof</span><span style="color:#B392F0"> DataSource) {</span></span>
<span class="line"><span style="color:#79B8FF">    key</span><span style="color:#B392F0">.historyRemove();    </span><span style="color:#6B737C">// Remove event listeners</span></span>
<span class="line"><span style="color:#79B8FF">    key</span><span style="color:#B392F0">.tickerStop();       </span><span style="color:#6B737C">// Stop streams</span></span>
<span class="line"><span style="color:#79B8FF">    DataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#sourceList</span><span style="color:#B392F0">.delete(key);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h3 id="efficient-state-switching">Efficient State Switching</h3>
<ul>
<li>States are reused when possible rather than recreated</li>
<li>Data is shared between compatible states</li>
<li>Minimal data copying through structured cloning only when necessary</li>
</ul>
<h3 id="stream-optimization">Stream Optimization</h3>
<ul>
<li>Single stream per symbol/timeframe combination</li>
<li>Automatic stream lifecycle management</li>
<li>Efficient tick data processing through Stream class</li>
</ul>
<h2 id="integration-examples">Integration Examples</h2>
<h3 id="basic-setup">Basic Setup</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> DataSource </span><span style="color:#F97583">from</span><span style="color:#FFAB70"> './dataSource.js'</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> TradeXChart </span><span style="color:#F97583">from</span><span style="color:#FFAB70"> './core.js'</span><span style="color:#B392F0">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> chart</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TradeXChart(container</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> config);</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> state</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> chart</span><span style="color:#B392F0">.state;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">  symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> '1h'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    name</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'myExchange'</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state);</span></span></code></pre>
<h3 id="advanced-setup-with-custom-data-provider">Advanced Setup with Custom Data Provider</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> CustomDataProvider {</span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> fetchHistoricalData(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetch(</span><span style="color:#FFAB70">`/api/history/</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">/</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">/</span><span style="color:#F97583">${</span><span style="color:#B392F0">timestamp</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> response</span><span style="color:#B392F0">.json();</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  startWebSocket(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> onTick) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> ws</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> WebSocket(</span><span style="color:#FFAB70">`wss://api.example.com/stream/</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">/</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#79B8FF">    ws</span><span style="color:#B392F0">.onmessage </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (event) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> onTick(</span><span style="color:#79B8FF">JSON</span><span style="color:#B392F0">.parse(</span><span style="color:#79B8FF">event</span><span style="color:#B392F0">.data));</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> ws;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> provider</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> CustomDataProvider();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">  symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    name</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'custom'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">    rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> provider</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">fetchHistoricalData</span><span style="color:#B392F0">.bind(provider)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">    tickerStream</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      start</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> provider</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">startWebSocket</span><span style="color:#B392F0">.bind(provider)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      stop</span><span style="color:#F97583">:</span><span style="color:#B392F0"> (ws) </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> ws</span><span style="color:#B392F0">.close()</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state);</span></span></code></pre>
<h3 id="multiple-timeframe-management">Multiple TimeFrame Management</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Create data source with multiple timeframes</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">  symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  timeFrames</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [</span><span style="color:#FFAB70">'1m'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '5m'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '15m'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1h'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '4h'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1d'</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> '1h'</span></span>
<span class="line"><span style="color:#B392F0">}</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Switch between timeframes</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrame </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> '5m'</span><span style="color:#B392F0">;   </span><span style="color:#6B737C">// Switches to 5-minute chart</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrame </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> '1d'</span><span style="color:#B392F0">;   </span><span style="color:#6B737C">// Switches to daily chart</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Each timeframe maintains its own state and data</span></span></code></pre>
<h2 id="testing-and-debugging">Testing and Debugging</h2>
<h3 id="debug-information">Debug Information</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Enable detailed logging</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.identifyState(); </span><span style="color:#6B737C">// Logs current state information</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Access internal state for debugging</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log({</span></span>
<span class="line"><span style="color:#B392F0">  symbol</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.symbol</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  timeFrame</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.timeFrameStr</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  isWaiting</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.#waiting</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C">    // Note: Private fields not accessible</span></span>
<span class="line"><span style="color:#B392F0">  stateKey</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">state</span><span style="color:#B392F0">.key</span></span>
<span class="line"><span style="color:#B392F0">});</span></span></code></pre>
<h3 id="mock-data-provider-for-testing">Mock Data Provider for Testing</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> mockProvider</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> (event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">    // Return mock historical data</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      chart</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">        data</span><span style="color:#F97583">:</span><span style="color:#B392F0"> generateMockCandles(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 100</span><span style="color:#B392F0">)</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  tickerStream</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    start</span><span style="color:#F97583">:</span><span style="color:#B392F0"> (symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> onTick) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">      // Simulate real-time ticks</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> interval</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> setInterval(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">        onTick(generateMockTick(symbol));</span></span>
<span class="line"><span style="color:#B392F0">      }</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 1000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#B392F0"> interval;</span></span>
<span class="line"><span style="color:#B392F0">    }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">    stop</span><span style="color:#F97583">:</span><span style="color:#B392F0"> (interval) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> clearInterval(interval)</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h2 id="migration-and-compatibility">Migration and Compatibility</h2>
<h3 id="upgrading-from-previous-versions">Upgrading from Previous Versions</h3>
<p>When upgrading DataSource implementations:</p>
<ol>
<li><strong>Function Signatures</strong>: Ensure fetch functions accept exactly 4 parameters</li>
<li><strong>Promise Returns</strong>: All async functions must return Promises</li>
<li><strong>Error Handling</strong>: Implement proper error handling in custom providers</li>
<li><strong>State Management</strong>: Update state access patterns for new API</li>
</ol>
<h3 id="backward-compatibility">Backward Compatibility</h3>
<p>DataSource maintains backward compatibility through:</p>
<ul>
<li>Default value fallbacks for missing configuration</li>
<li>Automatic timeframe detection from existing data</li>
<li>Graceful handling of legacy data formats</li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-resource-management">1. Resource Management</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Always clean up resources</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.historyRemove();  </span><span style="color:#6B737C">// Remove event listeners</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.tickerStop();     </span><span style="color:#6B737C">// Stop streams</span></span></code></pre>
<h3 id="2-error-handling">2. Error Handling</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Implement comprehensive error handling</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> fetchData </span><span style="color:#F97583">=</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> (event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">  try</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> data</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> apiCall(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> data;</span></span>
<span class="line"><span style="color:#B392F0">  } </span><span style="color:#F97583">catch</span><span style="color:#B392F0"> (error) {</span></span>
<span class="line"><span style="color:#79B8FF">    console</span><span style="color:#B392F0">.error(</span><span style="color:#FFAB70">'Data fetch failed:'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> error);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> {}; </span><span style="color:#6B737C">// Return empty object on failure</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h3 id="3-performance-optimization">3. Performance Optimization</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Use appropriate timeframes for data density</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> appropriateTimeframes</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  intraday</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [</span><span style="color:#FFAB70">'1m'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '5m'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '15m'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1h'</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  daily</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [</span><span style="color:#FFAB70">'4h'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1d'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1w'</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  longTerm</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [</span><span style="color:#FFAB70">'1w'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1M'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '3M'</span><span style="color:#B392F0">]</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h3 id="4-state-management">4. State Management</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Check for existing states before creating new ones</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> existing</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.findMatchingState();</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#B392F0"> (existing </span><span style="color:#F97583">instanceof</span><span style="color:#B392F0"> State) {</span></span>
<span class="line"><span style="color:#6B737C">  // Use existing state</span></span>
<span class="line"><span style="color:#79B8FF">  state</span><span style="color:#B392F0">.use(</span><span style="color:#79B8FF">existing</span><span style="color:#B392F0">.key);</span></span>
<span class="line"><span style="color:#B392F0">} </span><span style="color:#F97583">else</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">  // Create new state only when necessary</span></span>
<span class="line"><span style="color:#79B8FF">  state</span><span style="color:#B392F0">.use(newStateDefinition);</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h2 id="api-reference">API Reference</h2>
<h3 id="utility-functions">Utility Functions</h3>
<h4 id="consoleerrorcore-key-error">consoleError(core, key, error)</h4>
<p>Internal utility for consistent error logging.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">core</code> - TradeXChart core instance</li>
<li><code dir="auto">key</code> - State key for context</li>
<li><code dir="auto">error</code> - Error message string</li>
</ul>
<h4 id="throwerrorid-key-error">throwError(id, key, error)</h4>
<p>Internal utility for throwing formatted errors.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">id</code> - Chart ID</li>
<li><code dir="auto">key</code> - State key</li>
<li><code dir="auto">error</code> - Error message string</li>
</ul>
<h4 id="buildtimeframestimeframes">buildTimeFrames(timeframes)</h4>
<p>Converts array of timeframe milliseconds to timeframe object.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">timeframes</code> (Array<number>) - Array of timeframes in milliseconds</number></li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">Object</code> - Timeframe mapping object</p>
<h4 id="timeframe2mstimeframe">timeFrame2MS(timeframe)</h4>
<p>Converts timeframe string or number to milliseconds.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code dir="auto">timeframe</code> (String|Number) - Timeframe (e.g., “1h” or 3600000)</li>
</ul>
<p><strong>Returns:</strong> <code dir="auto">Number</code> - Timeframe in milliseconds</p>
<h2 id="event-system-integration">Event System Integration</h2>
<h3 id="core-events">Core Events</h3>
<p>DataSource integrates with the chart’s event system to provide seamless data loading:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Range limit events</span></span>
<span class="line"><span style="color:#79B8FF">core</span><span style="color:#B392F0">.on(</span><span style="color:#FFAB70">'range_limitPast'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> handler);    </span><span style="color:#6B737C">// Triggered when scrolling to past</span></span>
<span class="line"><span style="color:#79B8FF">core</span><span style="color:#B392F0">.on(</span><span style="color:#FFAB70">'range_limitFuture'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> handler);  </span><span style="color:#6B737C">// Triggered when scrolling to future</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Stream events  </span></span>
<span class="line"><span style="color:#79B8FF">core</span><span style="color:#B392F0">.on(</span><span style="color:#FFAB70">'stream_candleFirst'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> handler); </span><span style="color:#6B737C">// First real-time candle received</span></span>
<span class="line"><span style="color:#79B8FF">core</span><span style="color:#B392F0">.on(</span><span style="color:#FFAB70">'stream_candleUpdate'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> handler);</span><span style="color:#6B737C">// Real-time candle updates</span></span></code></pre>
<h3 id="custom-event-handlers">Custom Event Handlers</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Example: Custom range limit handler</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> customRangeLimitHandler </span><span style="color:#F97583">=</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> (event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">  // Log the request</span></span>
<span class="line"><span style="color:#79B8FF">  console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">`Fetching </span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70"> data for </span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">ms from </span><span style="color:#F97583">${</span><span style="color:#B392F0">timestamp</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#6B737C">  // Fetch data with retry logic</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#B392F0"> retries </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 3</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">  while</span><span style="color:#B392F0"> (retries </span><span style="color:#F97583">></span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#F97583">    try</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> data</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetchFromAPI(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp);</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">        chart</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { data</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> data</span><span style="color:#B392F0">.candles }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        volume</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { data</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> data</span><span style="color:#B392F0">.volume }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        trades</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { data</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> data</span><span style="color:#B392F0">.trades }</span></span>
<span class="line"><span style="color:#B392F0">      };</span></span>
<span class="line"><span style="color:#B392F0">    } </span><span style="color:#F97583">catch</span><span style="color:#B392F0"> (error) {</span></span>
<span class="line"><span style="color:#B392F0">      retries</span><span style="color:#F97583">--</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#B392F0"> (retries </span><span style="color:#F97583">===</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">throw</span><span style="color:#B392F0"> error;</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">(resolve </span><span style="color:#F97583">=></span><span style="color:#B392F0"> setTimeout(resolve</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 1000</span><span style="color:#B392F0">)); </span><span style="color:#6B737C">// Wait 1s before retry</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h2 id="data-formats">Data Formats</h2>
<h3 id="expected-data-structure">Expected Data Structure</h3>
<p>DataSource expects data in specific formats for different chart components:</p>
<h4 id="candle-data-format">Candle Data Format</h4>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> candleData</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  chart</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    data</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [</span></span>
<span class="line"><span style="color:#B392F0">      [timestamp</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> open</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> high</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> low</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> close</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> volume]</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // OHLCV array format</span></span>
<span class="line"><span style="color:#B392F0">      [</span><span style="color:#F8F8F8">1640995200000</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 47000</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 48000</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 46500</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 47500</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 1234.56</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#6B737C">      // ... more candles</span></span>
<span class="line"><span style="color:#B392F0">    ]</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h4 id="tick-data-format">Tick Data Format</h4>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> tickData</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  timestamp</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 1640995200000</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  price</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 47500.00</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  volume</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0.5</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  side</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'buy'</span><span style="color:#6B737C"> // or 'sell'</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h4 id="volume-data-format">Volume Data Format</h4>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> volumeData</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  volume</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    data</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [</span></span>
<span class="line"><span style="color:#B392F0">      [timestamp</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> volume</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> buyVolume</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> sellVolume]</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      [</span><span style="color:#F8F8F8">1640995200000</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 1234.56</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 800.00</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 434.56</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#6B737C">      // ... more volume data</span></span>
<span class="line"><span style="color:#B392F0">    ]</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h3 id="data-validation">Data Validation</h3>
<p>DataSource performs automatic validation on incoming data:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Validates candle data structure</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> isValidCandle </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (candle) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#79B8FF"> Array</span><span style="color:#B392F0">.isArray(candle) </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#B392F0"> </span></span>
<span class="line"><span style="color:#79B8FF">         candle</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> >=</span><span style="color:#F8F8F8"> 6</span><span style="color:#F97583"> &#x26;&#x26;</span></span>
<span class="line"><span style="color:#79B8FF">         candle</span><span style="color:#B392F0">.every(val </span><span style="color:#F97583">=></span><span style="color:#F97583"> typeof</span><span style="color:#B392F0"> val </span><span style="color:#F97583">===</span><span style="color:#FFAB70"> 'number'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Validates timestamp ordering</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> isChronological </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (data) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">  for</span><span style="color:#B392F0"> (</span><span style="color:#F97583">let</span><span style="color:#B392F0"> i </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 1</span><span style="color:#B392F0">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">; i</span><span style="color:#F97583">++</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (data[i][</span><span style="color:#F8F8F8">0</span><span style="color:#B392F0">] </span><span style="color:#F97583">&#x3C;=</span><span style="color:#B392F0"> data[i</span><span style="color:#F97583">-</span><span style="color:#F8F8F8">1</span><span style="color:#B392F0">][</span><span style="color:#F8F8F8">0</span><span style="color:#B392F0">]) </span><span style="color:#F97583">return</span><span style="color:#79B8FF"> false</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#79B8FF"> true</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">};</span></span></code></pre>
<h2 id="websocket-integration">WebSocket Integration</h2>
<h3 id="real-time-data-streaming">Real-time Data Streaming</h3>
<p>DataSource provides a standardized interface for WebSocket connections:</p>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> WebSocketProvider {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(baseUrl) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.baseUrl </span><span style="color:#F97583">=</span><span style="color:#B392F0"> baseUrl;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.connections </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map();</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  start(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> onTick) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> key</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> `</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">connections</span><span style="color:#B392F0">.has(key)) {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">connections</span><span style="color:#B392F0">.get(key).close();</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> ws</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> WebSocket(</span><span style="color:#FFAB70">`</span><span style="color:#F97583">${</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.baseUrl</span><span style="color:#F97583">}</span><span style="color:#FFAB70">/stream/</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">/</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    ws</span><span style="color:#B392F0">.onopen </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">      console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">`WebSocket connected for </span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#F97583"> ${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    ws</span><span style="color:#B392F0">.onmessage </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (event) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      try</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> data</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> JSON</span><span style="color:#B392F0">.parse(</span><span style="color:#79B8FF">event</span><span style="color:#B392F0">.data);</span></span>
<span class="line"><span style="color:#B392F0">        onTick(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.formatTick(data));</span></span>
<span class="line"><span style="color:#B392F0">      } </span><span style="color:#F97583">catch</span><span style="color:#B392F0"> (error) {</span></span>
<span class="line"><span style="color:#79B8FF">        console</span><span style="color:#B392F0">.error(</span><span style="color:#FFAB70">'Failed to parse WebSocket message:'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> error);</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    ws</span><span style="color:#B392F0">.onerror </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (error) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">      console</span><span style="color:#B392F0">.error(</span><span style="color:#FFAB70">'WebSocket error:'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> error);</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    ws</span><span style="color:#B392F0">.onclose </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">      console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">`WebSocket closed for </span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#F97583"> ${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">connections</span><span style="color:#B392F0">.delete(key);</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">connections</span><span style="color:#B392F0">.set(key</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> ws);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> ws;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  stop(ws) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (ws </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#79B8FF"> ws</span><span style="color:#B392F0">.readyState </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> WebSocket</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">OPEN</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#79B8FF">      ws</span><span style="color:#B392F0">.close();</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  formatTick(rawData) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      timestamp</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> rawData</span><span style="color:#B392F0">.t</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      price</span><span style="color:#F97583">:</span><span style="color:#B392F0"> parseFloat(</span><span style="color:#79B8FF">rawData</span><span style="color:#B392F0">.p)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      volume</span><span style="color:#F97583">:</span><span style="color:#B392F0"> parseFloat(</span><span style="color:#79B8FF">rawData</span><span style="color:#B392F0">.v)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      side</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> rawData</span><span style="color:#B392F0">.s</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h3 id="connection-management">Connection Management</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#6B737C">// Automatic reconnection logic</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> ReconnectingWebSocket {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(url</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> options </span><span style="color:#F97583">=</span><span style="color:#B392F0"> {}) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.url </span><span style="color:#F97583">=</span><span style="color:#B392F0"> url;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.options </span><span style="color:#F97583">=</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      maxReconnectAttempts</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 5</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      reconnectInterval</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 1000</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#F97583">      ...</span><span style="color:#B392F0">options</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.reconnectAttempts </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  connect(onMessage) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.ws </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> WebSocket(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.url);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">ws</span><span style="color:#B392F0">.onopen </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.reconnectAttempts </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#79B8FF">      console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'WebSocket connected'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">ws</span><span style="color:#B392F0">.onmessage </span><span style="color:#F97583">=</span><span style="color:#B392F0"> onMessage;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">ws</span><span style="color:#B392F0">.onclose </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.reconnectAttempts </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">options</span><span style="color:#B392F0">.maxReconnectAttempts) {</span></span>
<span class="line"><span style="color:#B392F0">        setTimeout(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">          this</span><span style="color:#B392F0">.reconnectAttempts</span><span style="color:#F97583">++</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#79B8FF">          this</span><span style="color:#B392F0">.connect(onMessage);</span></span>
<span class="line"><span style="color:#B392F0">        }</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">options</span><span style="color:#B392F0">.reconnectInterval);</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h2 id="caching-strategies">Caching Strategies</h2>
<h3 id="memory-based-caching">Memory-Based Caching</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> DataCache {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(maxSize </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 1000</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.cache </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map();</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.maxSize </span><span style="color:#F97583">=</span><span style="color:#B392F0"> maxSize;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  get(key) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.has(key)) {</span></span>
<span class="line"><span style="color:#6B737C">      // Move to end (LRU)</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> value</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.get(key);</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.delete(key);</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.set(key</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> value);</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#B392F0"> value;</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> null</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  set(key</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> value) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.has(key)) {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.delete(key);</span></span>
<span class="line"><span style="color:#B392F0">    } </span><span style="color:#F97583">else</span><span style="color:#F97583"> if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.size </span><span style="color:#F97583">>=</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.maxSize) {</span></span>
<span class="line"><span style="color:#6B737C">      // Remove oldest entry</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> firstKey</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.keys().next().value;</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.delete(firstKey);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">cache</span><span style="color:#B392F0">.set(key</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> value);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  generateKey(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#FFAB70"> `</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#79B8FF">Math</span><span style="color:#B392F0">.floor(timestamp </span><span style="color:#F97583">/</span><span style="color:#B392F0"> timeframe)</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h3 id="persistent-caching">Persistent Caching</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> PersistentCache {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(dbName </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> 'TradeXCache'</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.dbName </span><span style="color:#F97583">=</span><span style="color:#B392F0"> dbName;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.initDB();</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> initDB() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">((resolve</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> reject) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> request</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> indexedDB</span><span style="color:#B392F0">.open(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.dbName</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 1</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#79B8FF">      request</span><span style="color:#B392F0">.onerror </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> reject(</span><span style="color:#79B8FF">request</span><span style="color:#B392F0">.error);</span></span>
<span class="line"><span style="color:#79B8FF">      request</span><span style="color:#B392F0">.onsuccess </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#B392F0">.db </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> request</span><span style="color:#B392F0">.result;</span></span>
<span class="line"><span style="color:#B392F0">        resolve();</span></span>
<span class="line"><span style="color:#B392F0">      };</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#79B8FF">      request</span><span style="color:#B392F0">.onupgradeneeded </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (event) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> db</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> event</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">target</span><span style="color:#B392F0">.result;</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> store</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> db</span><span style="color:#B392F0">.createObjectStore(</span><span style="color:#FFAB70">'candles'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> { keyPath</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'key'</span><span style="color:#B392F0"> });</span></span>
<span class="line"><span style="color:#79B8FF">        store</span><span style="color:#B392F0">.createIndex(</span><span style="color:#FFAB70">'symbol'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> 'symbol'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> { unique</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> false</span><span style="color:#B392F0"> });</span></span>
<span class="line"><span style="color:#79B8FF">        store</span><span style="color:#B392F0">.createIndex(</span><span style="color:#FFAB70">'timeframe'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> 'timeframe'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> { unique</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> false</span><span style="color:#B392F0"> });</span></span>
<span class="line"><span style="color:#B392F0">      };</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> store(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> data) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> transaction</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">db</span><span style="color:#B392F0">.transaction([</span><span style="color:#FFAB70">'candles'</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> 'readwrite'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> store</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> transaction</span><span style="color:#B392F0">.objectStore(</span><span style="color:#FFAB70">'candles'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> key</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> `</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">timestamp</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#79B8FF"> store</span><span style="color:#B392F0">.put({</span></span>
<span class="line"><span style="color:#B392F0">      key</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      symbol</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      timeframe</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      timestamp</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      data</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      cached</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Date</span><span style="color:#B392F0">.now()</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> retrieve(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> startTime</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> endTime) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> transaction</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">db</span><span style="color:#B392F0">.transaction([</span><span style="color:#FFAB70">'candles'</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> 'readonly'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> store</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> transaction</span><span style="color:#B392F0">.objectStore(</span><span style="color:#FFAB70">'candles'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> results</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> [];</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> range</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> IDBKeyRange</span><span style="color:#B392F0">.bound(</span></span>
<span class="line"><span style="color:#FFAB70">      `</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">startTime</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#FFAB70">      `</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#B392F0">endTime</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span></span>
<span class="line"><span style="color:#B392F0">    );</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">((resolve) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">      store</span><span style="color:#B392F0">.openCursor(range).onsuccess </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (event) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> cursor</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> event</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">target</span><span style="color:#B392F0">.result;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#B392F0"> (cursor) {</span></span>
<span class="line"><span style="color:#79B8FF">          results</span><span style="color:#B392F0">.push(</span><span style="color:#79B8FF">cursor</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">value</span><span style="color:#B392F0">.data);</span></span>
<span class="line"><span style="color:#79B8FF">          cursor</span><span style="color:#B392F0">.continue();</span></span>
<span class="line"><span style="color:#B392F0">        } </span><span style="color:#F97583">else</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">          resolve(results);</span></span>
<span class="line"><span style="color:#B392F0">        }</span></span>
<span class="line"><span style="color:#B392F0">      };</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h2 id="advanced-configuration">Advanced Configuration</h2>
<h3 id="multi-exchange-setup">Multi-Exchange Setup</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> MultiExchangeDataSource {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.exchanges </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map();</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.primaryExchange </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> null</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  addExchange(name</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> config) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#F97583">      ...</span><span style="color:#B392F0">config</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { name</span><span style="color:#BBBBBB">,</span><span style="color:#F97583"> ...</span><span style="color:#79B8FF">config</span><span style="color:#B392F0">.source }</span></span>
<span class="line"><span style="color:#B392F0">    }</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> config</span><span style="color:#B392F0">.state);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">exchanges</span><span style="color:#B392F0">.set(name</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> dataSource);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.primaryExchange) {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.primaryExchange </span><span style="color:#F97583">=</span><span style="color:#B392F0"> name;</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> fetchFromBestSource(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> promises</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Array</span><span style="color:#B392F0">.from(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">exchanges</span><span style="color:#B392F0">.values()).map(ds </span><span style="color:#F97583">=></span><span style="color:#B392F0"> </span></span>
<span class="line"><span style="color:#79B8FF">      ds</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">source</span><span style="color:#B392F0">.rangeLimitPast(</span><span style="color:#79B8FF">null</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp)</span></span>
<span class="line"><span style="color:#B392F0">        .catch(error </span><span style="color:#F97583">=></span><span style="color:#B392F0"> ({ error</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> exchange</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> ds</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">source</span><span style="color:#B392F0">.name }))</span></span>
<span class="line"><span style="color:#B392F0">    );</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> results</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">.allSettled(promises);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Return first successful result</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#B392F0"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> of</span><span style="color:#B392F0"> results) {</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">result</span><span style="color:#B392F0">.status </span><span style="color:#F97583">===</span><span style="color:#FFAB70"> 'fulfilled'</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#F97583"> !</span><span style="color:#79B8FF">result</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">value</span><span style="color:#B392F0">.error) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> result</span><span style="color:#B392F0">.value;</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error(</span><span style="color:#FFAB70">'All exchanges failed to provide data'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h3 id="aggregated-data-sources">Aggregated Data Sources</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> AggregatedDataSource </span><span style="color:#F97583">extends</span><span style="color:#B392F0"> DataSource {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(sources</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> aggregationMethod </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> 'average'</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#B392F0">    super(</span><span style="color:#F97583">...</span><span style="color:#B392F0">arguments);</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.sources </span><span style="color:#F97583">=</span><span style="color:#B392F0"> sources;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.aggregationMethod </span><span style="color:#F97583">=</span><span style="color:#B392F0"> aggregationMethod;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> fetchAggregatedData(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> promises</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">sources</span><span style="color:#B392F0">.map(source </span><span style="color:#F97583">=></span><span style="color:#B392F0"> </span></span>
<span class="line"><span style="color:#79B8FF">      source</span><span style="color:#B392F0">.rangeLimitPast(</span><span style="color:#79B8FF">null</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp)</span></span>
<span class="line"><span style="color:#B392F0">    );</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> results</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">.allSettled(promises);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> validResults</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> results</span></span>
<span class="line"><span style="color:#B392F0">      .filter(r </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> r</span><span style="color:#B392F0">.status </span><span style="color:#F97583">===</span><span style="color:#FFAB70"> 'fulfilled'</span><span style="color:#B392F0">)</span></span>
<span class="line"><span style="color:#B392F0">      .map(r </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> r</span><span style="color:#B392F0">.value);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">validResults</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#F97583">      throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error(</span><span style="color:#FFAB70">'No valid data sources available'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.aggregateData(validResults);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  aggregateData(datasets) {</span></span>
<span class="line"><span style="color:#F97583">    switch</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.aggregationMethod) {</span></span>
<span class="line"><span style="color:#F97583">      case</span><span style="color:#FFAB70"> 'average'</span><span style="color:#B392F0">:</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.averageData(datasets);</span></span>
<span class="line"><span style="color:#F97583">      case</span><span style="color:#FFAB70"> 'median'</span><span style="color:#B392F0">:</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.medianData(datasets);</span></span>
<span class="line"><span style="color:#F97583">      case</span><span style="color:#FFAB70"> 'weighted'</span><span style="color:#B392F0">:</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.weightedData(datasets);</span></span>
<span class="line"><span style="color:#F97583">      default</span><span style="color:#B392F0">:</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> datasets[</span><span style="color:#F8F8F8">0</span><span style="color:#B392F0">]; </span><span style="color:#6B737C">// Return first dataset as fallback</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  averageData(datasets) {</span></span>
<span class="line"><span style="color:#6B737C">    // Implementation for averaging OHLCV data across sources</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> aggregated</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> { chart</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { data</span><span style="color:#F97583">:</span><span style="color:#B392F0"> [] } };</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> maxLength</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.max(</span><span style="color:#F97583">...</span><span style="color:#79B8FF">datasets</span><span style="color:#B392F0">.map(d </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> d</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">));</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#B392F0"> (</span><span style="color:#F97583">let</span><span style="color:#B392F0"> i </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#B392F0"> maxLength; i</span><span style="color:#F97583">++</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> candles</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> datasets</span></span>
<span class="line"><span style="color:#B392F0">        .map(d </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> d</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.data[i])</span></span>
<span class="line"><span style="color:#B392F0">        .filter(Boolean);</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">candles</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ></span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> avgCandle</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> [</span></span>
<span class="line"><span style="color:#B392F0">          candles[</span><span style="color:#F8F8F8">0</span><span style="color:#B392F0">][</span><span style="color:#F8F8F8">0</span><span style="color:#B392F0">]</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // timestamp (same for all)</span></span>
<span class="line"><span style="color:#79B8FF">          this</span><span style="color:#B392F0">.average(</span><span style="color:#79B8FF">candles</span><span style="color:#B392F0">.map(c </span><span style="color:#F97583">=></span><span style="color:#B392F0"> c[</span><span style="color:#F8F8F8">1</span><span style="color:#B392F0">]))</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // open</span></span>
<span class="line"><span style="color:#79B8FF">          Math</span><span style="color:#B392F0">.max(</span><span style="color:#F97583">...</span><span style="color:#79B8FF">candles</span><span style="color:#B392F0">.map(c </span><span style="color:#F97583">=></span><span style="color:#B392F0"> c[</span><span style="color:#F8F8F8">2</span><span style="color:#B392F0">]))</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // high</span></span>
<span class="line"><span style="color:#79B8FF">          Math</span><span style="color:#B392F0">.min(</span><span style="color:#F97583">...</span><span style="color:#79B8FF">candles</span><span style="color:#B392F0">.map(c </span><span style="color:#F97583">=></span><span style="color:#B392F0"> c[</span><span style="color:#F8F8F8">3</span><span style="color:#B392F0">]))</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // low</span></span>
<span class="line"><span style="color:#79B8FF">          this</span><span style="color:#B392F0">.average(</span><span style="color:#79B8FF">candles</span><span style="color:#B392F0">.map(c </span><span style="color:#F97583">=></span><span style="color:#B392F0"> c[</span><span style="color:#F8F8F8">4</span><span style="color:#B392F0">]))</span><span style="color:#BBBBBB">,</span><span style="color:#6B737C"> // close</span></span>
<span class="line"><span style="color:#79B8FF">          this</span><span style="color:#B392F0">.sum(</span><span style="color:#79B8FF">candles</span><span style="color:#B392F0">.map(c </span><span style="color:#F97583">=></span><span style="color:#B392F0"> c[</span><span style="color:#F8F8F8">5</span><span style="color:#B392F0">]))     </span><span style="color:#6B737C">// volume</span></span>
<span class="line"><span style="color:#B392F0">        ];</span></span>
<span class="line"><span style="color:#79B8FF">        aggregated</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.push(avgCandle);</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> aggregated;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  average(values) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> values</span><span style="color:#B392F0">.reduce((sum</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> val) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> sum </span><span style="color:#F97583">+</span><span style="color:#B392F0"> val</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> values</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  sum(values) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> values</span><span style="color:#B392F0">.reduce((sum</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> val) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> sum </span><span style="color:#F97583">+</span><span style="color:#B392F0"> val</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span></code></pre>
<h2 id="performance-monitoring">Performance Monitoring</h2>
<h3 id="metrics-collection">Metrics Collection</h3>
<pre class="astro-code min-dark" style="background-color:#1f1f1f;color:#b392f0; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> DataSourceMetrics {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(dataSource) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.dataSource </span><span style="color:#F97583">=</span><span style="color:#B392F0"> dataSource;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.metrics </span><span style="color:#F97583">=</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      fetchCount</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      fetchTime</span><span style="color:#F97583">:</span><span style="color:#B392F0"> []</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      errorCount</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      cacheHits</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      cacheMisses</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  wrapFetchFunction(originalFetch) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> (</span><span style="color:#F97583">...</span><span style="color:#B392F0">args) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> startTime</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> performance</span><span style="color:#B392F0">.now();</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.fetchCount</span><span style="color:#F97583">++</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#F97583">      try</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> originalFetch</span><span style="color:#B392F0">.apply(</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.dataSource</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> args);</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> endTime</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> performance</span><span style="color:#B392F0">.now();</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">fetchTime</span><span style="color:#B392F0">.push(endTime </span><span style="color:#F97583">-</span><span style="color:#B392F0"> startTime);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> result;</span></span>
<span class="line"><span style="color:#B392F0">      } </span><span style="color:#F97583">catch</span><span style="color:#B392F0"> (error) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.errorCount</span><span style="color:#F97583">++</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">        throw</span><span style="color:#B392F0"> error;</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  getAverageResponseTime() {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">fetchTime</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">return</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">fetchTime</span><span style="color:#B392F0">.reduce((sum</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> time) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> sum </span><span style="color:#F97583">+</span><span style="color:#B392F0"> time</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">/</span><span style="color:#B392F0"> </span></span>
<span class="line"><span style="color:#79B8FF">           this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">fetchTime</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  getErrorRate() {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.fetchCount </span><span style="color:#F97583">===</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">return</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.errorCount </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.fetchCount;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  getCacheHitRate() {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> total</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.cacheHits </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.cacheMisses;</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (total </span><span style="color:#F97583">===</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">return</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.cacheHits </span><span style="color:#F97583">/</span><span style="color:#B392F0"> total;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  generateReport() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      totalFetches</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.fetchCount</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      averageResponseTime</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.getAverageResponseTime()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      errorRate</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.getErrorRate()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      cacheHitRate</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.getCacheHitRate()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      totalErrors</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">metrics</span><span style="color:#B392F0">.errorCount</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  reset() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.metrics </span><span style="color:#F97583">=</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      fetchCount</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      fetchTime</span><span style="color:#F97583">:</span><span style="color:#B392F0"> []</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      errorCount</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      cacheHits</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      cacheMisses</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 0</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### Performance Optimization Techniques</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> OptimizedDataSource </span><span style="color:#F97583">extends</span><span style="color:#B392F0"> DataSource {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(cfg</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state) {</span></span>
<span class="line"><span style="color:#B392F0">    super(cfg</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state);</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.requestQueue </span><span style="color:#F97583">=</span><span style="color:#B392F0"> [];</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.processingQueue </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.batchSize </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 10</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.batchTimeout </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 100</span><span style="color:#B392F0">; </span><span style="color:#6B737C">// ms</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#6B737C">  // Batch multiple requests together</span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> batchRequest(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">((resolve</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> reject) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">requestQueue</span><span style="color:#B392F0">.push({ symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> resolve</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> reject });</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.processingQueue) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#B392F0">.processingQueue </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">        setTimeout(() </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.processBatch()</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.batchTimeout);</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> processBatch() {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> batch</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">requestQueue</span><span style="color:#B392F0">.splice(</span><span style="color:#F8F8F8">0</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.batchSize);</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.processingQueue </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">batch</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">return</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    try</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">      // Group requests by symbol and timeframe</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> grouped</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> batch</span><span style="color:#B392F0">.reduce((acc</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> req) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> key</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> `</span><span style="color:#F97583">${</span><span style="color:#79B8FF">req</span><span style="color:#B392F0">.symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">_</span><span style="color:#F97583">${</span><span style="color:#79B8FF">req</span><span style="color:#B392F0">.timeframe</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#B392F0">acc[key]) acc[key] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> [];</span></span>
<span class="line"><span style="color:#B392F0">        acc[key].push(req);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> acc;</span></span>
<span class="line"><span style="color:#B392F0">      }</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {});</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#6B737C">      // Process each group</span></span>
<span class="line"><span style="color:#F97583">      for</span><span style="color:#B392F0"> (</span><span style="color:#F97583">const</span><span style="color:#B392F0"> [</span><span style="color:#79B8FF">key</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> requests</span><span style="color:#B392F0">] </span><span style="color:#F97583">of</span><span style="color:#79B8FF"> Object</span><span style="color:#B392F0">.entries(grouped)) {</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#B392F0"> [</span><span style="color:#79B8FF">symbol</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> timeframe</span><span style="color:#B392F0">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> key</span><span style="color:#B392F0">.split(</span><span style="color:#FFAB70">'_'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> timestamps</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> requests</span><span style="color:#B392F0">.map(r </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> r</span><span style="color:#B392F0">.timestamp);</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> minTime</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.min(</span><span style="color:#F97583">...</span><span style="color:#B392F0">timestamps);</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> maxTime</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.max(</span><span style="color:#F97583">...</span><span style="color:#B392F0">timestamps);</span></span>
<span class="line"><span style="color:#B392F0">        </span></span>
<span class="line"><span style="color:#6B737C">        // Fetch data for the entire range</span></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> data</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.fetchRange(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> parseInt(timeframe)</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> minTime</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> maxTime);</span></span>
<span class="line"><span style="color:#B392F0">        </span></span>
<span class="line"><span style="color:#6B737C">        // Distribute results to individual requests</span></span>
<span class="line"><span style="color:#79B8FF">        requests</span><span style="color:#B392F0">.forEach(req </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">          const</span><span style="color:#79B8FF"> relevantData</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.extractRelevantData(data</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> req</span><span style="color:#B392F0">.timestamp);</span></span>
<span class="line"><span style="color:#79B8FF">          req</span><span style="color:#B392F0">.resolve(relevantData);</span></span>
<span class="line"><span style="color:#B392F0">        });</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    } </span><span style="color:#F97583">catch</span><span style="color:#B392F0"> (error) {</span></span>
<span class="line"><span style="color:#6B737C">      // Reject all requests in the batch</span></span>
<span class="line"><span style="color:#79B8FF">      batch</span><span style="color:#B392F0">.forEach(req </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> req</span><span style="color:#B392F0">.reject(error));</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Process remaining queue if any</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">requestQueue</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ></span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.processingQueue </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">      setTimeout(() </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.processBatch()</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.batchTimeout);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#6B737C">  // Prefetch data based on user behavior</span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> prefetchData(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> currentTimestamp) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> prefetchAmount</span><span style="color:#F97583"> =</span><span style="color:#F8F8F8"> 100</span><span style="color:#B392F0">; </span><span style="color:#6B737C">// Number of candles to prefetch</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> timeframeDuration</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> parseInt(timeframe);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> futureTimestamp</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> currentTimestamp </span><span style="color:#F97583">+</span><span style="color:#B392F0"> (prefetchAmount </span><span style="color:#F97583">*</span><span style="color:#B392F0"> timeframeDuration);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Prefetch in background without blocking</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.fetchRange(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> currentTimestamp</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> futureTimestamp)</span></span>
<span class="line"><span style="color:#B392F0">      .catch(error </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> console</span><span style="color:#B392F0">.warn(</span><span style="color:#FFAB70">'Prefetch failed:'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> error));</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">## Security Considerations</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### API Key Management</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> SecureDataSource </span><span style="color:#F97583">extends</span><span style="color:#B392F0"> DataSource {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(cfg</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state) {</span></span>
<span class="line"><span style="color:#B392F0">    super(cfg</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state);</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.apiKeys </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map();</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.rateLimiter </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> RateLimiter();</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  setApiKey(exchange</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> apiKey</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> secret) {</span></span>
<span class="line"><span style="color:#6B737C">    // Store encrypted credentials</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">apiKeys</span><span style="color:#B392F0">.set(exchange</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      key</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.encrypt(apiKey)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      secret</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.encrypt(secret)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      timestamp</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Date</span><span style="color:#B392F0">.now()</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  encrypt(data) {</span></span>
<span class="line"><span style="color:#6B737C">    // Use Web Crypto API for encryption</span></span>
<span class="line"><span style="color:#6B737C">    // Implementation depends on your security requirements</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> btoa(data); </span><span style="color:#6B737C">// Simple base64 for example</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  decrypt(encryptedData) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> atob(encryptedData);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  async</span><span style="color:#B392F0"> authenticatedRequest(exchange</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> endpoint</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> params) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> credentials</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">apiKeys</span><span style="color:#B392F0">.get(exchange);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#B392F0">credentials) {</span></span>
<span class="line"><span style="color:#F97583">      throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error(</span><span style="color:#FFAB70">`No credentials found for exchange: </span><span style="color:#F97583">${</span><span style="color:#B392F0">exchange</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Check rate limits</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">rateLimiter</span><span style="color:#B392F0">.canMakeRequest(exchange)) {</span></span>
<span class="line"><span style="color:#F97583">      throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error(</span><span style="color:#FFAB70">`Rate limit exceeded for </span><span style="color:#F97583">${</span><span style="color:#B392F0">exchange</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> apiKey</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.decrypt(</span><span style="color:#79B8FF">credentials</span><span style="color:#B392F0">.key);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> secret</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.decrypt(</span><span style="color:#79B8FF">credentials</span><span style="color:#B392F0">.secret);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Create authenticated request</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> signature</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.createSignature(params</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> secret);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> fetch(endpoint</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      headers</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#FFAB70">        'X-API-Key'</span><span style="color:#F97583">:</span><span style="color:#B392F0"> apiKey</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#FFAB70">        'X-Signature'</span><span style="color:#F97583">:</span><span style="color:#B392F0"> signature</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#FFAB70">        'Content-Type'</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'application/json'</span></span>
<span class="line"><span style="color:#B392F0">      }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      body</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> JSON</span><span style="color:#B392F0">.stringify(params)</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  createSignature(params</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> secret) {</span></span>
<span class="line"><span style="color:#6B737C">    // Implementation depends on exchange requirements</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> queryString</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Object</span><span style="color:#B392F0">.keys(params)</span></span>
<span class="line"><span style="color:#B392F0">      .sort()</span></span>
<span class="line"><span style="color:#B392F0">      .map(key </span><span style="color:#F97583">=></span><span style="color:#FFAB70"> `</span><span style="color:#F97583">${</span><span style="color:#B392F0">key</span><span style="color:#F97583">}</span><span style="color:#FFAB70">=</span><span style="color:#F97583">${</span><span style="color:#B392F0">params[key]</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">)</span></span>
<span class="line"><span style="color:#B392F0">      .join(</span><span style="color:#FFAB70">'&#x26;'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Use HMAC-SHA256 or similar</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.hmacSha256(queryString</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> secret);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### Rate Limiting</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> RateLimiter {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.limits </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map();</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.requests </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Map();</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  setLimit(exchange</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> requestsPerSecond) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">limits</span><span style="color:#B392F0">.set(exchange</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      requests</span><span style="color:#F97583">:</span><span style="color:#B392F0"> requestsPerSecond</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      window</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 1000</span><span style="color:#6B737C"> // 1 second</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  canMakeRequest(exchange) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> limit</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">limits</span><span style="color:#B392F0">.get(exchange);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#B392F0">limit) </span><span style="color:#F97583">return</span><span style="color:#79B8FF"> true</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> now</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Date</span><span style="color:#B392F0">.now();</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> requests</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">requests</span><span style="color:#B392F0">.get(exchange) </span><span style="color:#F97583">||</span><span style="color:#B392F0"> [];</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Remove old requests outside the window</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> validRequests</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> requests</span><span style="color:#B392F0">.filter(time </span><span style="color:#F97583">=></span><span style="color:#B392F0"> now </span><span style="color:#F97583">-</span><span style="color:#B392F0"> time </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> limit</span><span style="color:#B392F0">.window);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">validRequests</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> >=</span><span style="color:#79B8FF"> limit</span><span style="color:#B392F0">.requests) {</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#79B8FF"> false</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Add current request</span></span>
<span class="line"><span style="color:#79B8FF">    validRequests</span><span style="color:#B392F0">.push(now);</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">requests</span><span style="color:#B392F0">.set(exchange</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> validRequests);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> true</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  getWaitTime(exchange) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> limit</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">limits</span><span style="color:#B392F0">.get(exchange);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> requests</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">requests</span><span style="color:#B392F0">.get(exchange) </span><span style="color:#F97583">||</span><span style="color:#B392F0"> [];</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">requests</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">) </span><span style="color:#F97583">return</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> oldestRequest</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.min(</span><span style="color:#F97583">...</span><span style="color:#B392F0">requests);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> waitTime</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> limit</span><span style="color:#B392F0">.window </span><span style="color:#F97583">-</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">Date</span><span style="color:#B392F0">.now() </span><span style="color:#F97583">-</span><span style="color:#B392F0"> oldestRequest);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.max(</span><span style="color:#F8F8F8">0</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> waitTime);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">## Testing Framework</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### Unit Tests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">// Example test suite for DataSource</span></span>
<span class="line"><span style="color:#B392F0">describe(</span><span style="color:#FFAB70">'DataSource'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#B392F0"> mockCore</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> mockState</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> dataSource;</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  beforeEach(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    mockCore </span><span style="color:#F97583">=</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      id</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'test-chart'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      config</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#B392F0"> }</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      on</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      off</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      error</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      log</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      progress</span><span style="color:#F97583">:</span><span style="color:#B392F0"> { start</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn()</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> stop</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn() }</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    mockState </span><span style="color:#F97583">=</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      core</span><span style="color:#F97583">:</span><span style="color:#B392F0"> mockCore</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      key</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'test-state'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      isEmpty</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> false</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      isActive</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> true</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      mergeData</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      use</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      list</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> [])</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    dataSource </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">      symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 3600000</span></span>
<span class="line"><span style="color:#B392F0">    }</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> mockState);</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  afterEach(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (dataSource) {</span></span>
<span class="line"><span style="color:#79B8FF">      DataSource</span><span style="color:#B392F0">.delete(dataSource);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  describe(</span><span style="color:#FFAB70">'constructor'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should create a valid DataSource instance'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      expect(dataSource).toBeInstanceOf(DataSource);</span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.symbol).toBe(</span><span style="color:#FFAB70">'BTC/USDT'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrameMS).toBe(</span><span style="color:#F8F8F8">3600000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should generate unique ID'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> dataSource2</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">        symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'ETH/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 3600000</span></span>
<span class="line"><span style="color:#B392F0">      }</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> mockState);</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.id).</span><span style="color:#79B8FF">not</span><span style="color:#B392F0">.toBe(</span><span style="color:#79B8FF">dataSource2</span><span style="color:#B392F0">.id);</span></span>
<span class="line"><span style="color:#79B8FF">      DataSource</span><span style="color:#B392F0">.delete(dataSource2);</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  describe(</span><span style="color:#FFAB70">'timeFrame management'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should validate timeframes correctly'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrameValidate(</span><span style="color:#F8F8F8">3600000</span><span style="color:#B392F0">)).toBe(</span><span style="color:#F8F8F8">3600000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrameValidate(</span><span style="color:#FFAB70">'1h'</span><span style="color:#B392F0">)).toBe(</span><span style="color:#F8F8F8">3600000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      expect(() </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.timeFrameValidate(</span><span style="color:#FFAB70">'invalid'</span><span style="color:#B392F0">)).toThrow();</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should switch timeframes'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">      dataSource</span><span style="color:#B392F0">.timeFrame </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> '5m'</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrameMS).toBe(</span><span style="color:#F8F8F8">300000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.timeFrameStr).toBe(</span><span style="color:#FFAB70">'5m'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  describe(</span><span style="color:#FFAB70">'ticker stream'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should start ticker stream successfully'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> mockStart</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn();</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> mockStop</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn();</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#79B8FF">      dataSource</span><span style="color:#B392F0">.tickerAdd({</span></span>
<span class="line"><span style="color:#B392F0">        start</span><span style="color:#F97583">:</span><span style="color:#B392F0"> mockStart</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        stop</span><span style="color:#F97583">:</span><span style="color:#B392F0"> mockStop</span></span>
<span class="line"><span style="color:#B392F0">      });</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.tickerStart(</span><span style="color:#FFAB70">'BTC/USDT'</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      expect(result).toBe(</span><span style="color:#79B8FF">true</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      expect(mockStart).toHaveBeenCalledWith(</span><span style="color:#FFAB70">'BTC/USDT'</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> expect</span><span style="color:#B392F0">.any(Function));</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should reject mismatched symbols'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.tickerStart(</span><span style="color:#FFAB70">'ETH/USDT'</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">      expect(result).toBe(</span><span style="color:#79B8FF">false</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  describe(</span><span style="color:#FFAB70">'history management'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should add history functions'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> mockRangeLimitPast</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> jest</span><span style="color:#B392F0">.fn(() </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">.resolve({}));</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#79B8FF">      dataSource</span><span style="color:#B392F0">.historyAdd({</span></span>
<span class="line"><span style="color:#B392F0">        rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#B392F0"> mockRangeLimitPast</span></span>
<span class="line"><span style="color:#B392F0">      });</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">mockCore</span><span style="color:#B392F0">.on).toHaveBeenCalledWith(</span></span>
<span class="line"><span style="color:#FFAB70">        'range_limitPast'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#79B8FF">        expect</span><span style="color:#B392F0">.any(Function)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        dataSource</span></span>
<span class="line"><span style="color:#B392F0">      );</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    it(</span><span style="color:#FFAB70">'should validate function parameters'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> invalidFunction </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {}; </span><span style="color:#6B737C">// 0 parameters instead of 4</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#79B8FF">      dataSource</span><span style="color:#B392F0">.historyAdd({</span></span>
<span class="line"><span style="color:#B392F0">        rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#B392F0"> invalidFunction</span></span>
<span class="line"><span style="color:#B392F0">      });</span></span>
<span class="line"><span style="color:#B392F0">      </span></span>
<span class="line"><span style="color:#B392F0">      expect(</span><span style="color:#79B8FF">mockCore</span><span style="color:#B392F0">.error).toHaveBeenCalled();</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">});</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### Integration Tests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#B392F0">describe(</span><span style="color:#FFAB70">'DataSource Integration'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#B392F0"> chart</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> dataSource;</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  beforeEach(</span><span style="color:#F97583">async</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">    // Create actual chart instance</span></span>
<span class="line"><span style="color:#B392F0">    chart </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TradeXChart(</span><span style="color:#79B8FF">document</span><span style="color:#B392F0">.createElement(</span><span style="color:#FFAB70">'div'</span><span style="color:#B392F0">)</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#79B8FF"> chart</span><span style="color:#B392F0">.ready;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    dataSource </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">      symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> '1h'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">        name</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'test-exchange'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#B392F0"> mockFetchHistoricalData</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        tickerStream</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">          start</span><span style="color:#F97583">:</span><span style="color:#B392F0"> mockStartTicker</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">          stop</span><span style="color:#F97583">:</span><span style="color:#B392F0"> mockStopTicker</span></span>
<span class="line"><span style="color:#B392F0">        }</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    }</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> chart</span><span style="color:#B392F0">.state);</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  afterEach(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">    chart</span><span style="color:#B392F0">.destroy();</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  it(</span><span style="color:#FFAB70">'should load historical data on range limit'</span><span style="color:#BBBBBB">,</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">    // Simulate scrolling to trigger range limit</span></span>
<span class="line"><span style="color:#79B8FF">    chart</span><span style="color:#B392F0">.emit(</span><span style="color:#FFAB70">'range_limitPast'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      startTS</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Date</span><span style="color:#B392F0">.now() </span><span style="color:#F97583">-</span><span style="color:#F8F8F8"> 86400000</span><span style="color:#6B737C"> // 1 day ago</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Wait for data to load</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> Promise</span><span style="color:#B392F0">(resolve </span><span style="color:#F97583">=></span><span style="color:#B392F0"> setTimeout(resolve</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 100</span><span style="color:#B392F0">));</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    expect(</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">state</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">).toBeGreaterThan(</span><span style="color:#F8F8F8">0</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  it(</span><span style="color:#FFAB70">'should handle real-time updates'</span><span style="color:#BBBBBB">,</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">    // Start ticker</span></span>
<span class="line"><span style="color:#79B8FF">    dataSource</span><span style="color:#B392F0">.tickerStart(</span><span style="color:#FFAB70">'BTC/USDT'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1h'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Simulate tick data</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> mockTick</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      timestamp</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Date</span><span style="color:#B392F0">.now()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      price</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 50000</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      volume</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 1.5</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">stream</span><span style="color:#B392F0">.onTick(mockTick);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Verify data was processed</span></span>
<span class="line"><span style="color:#B392F0">    expect(</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">state</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">).toBeGreaterThan(</span><span style="color:#F8F8F8">0</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">  });</span></span>
<span class="line"><span style="color:#B392F0">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Mock functions for testing</span></span>
<span class="line"><span style="color:#F97583">async</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> mockFetchHistoricalData(event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    chart</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      data</span><span style="color:#F97583">:</span><span style="color:#B392F0"> generateMockCandles(</span><span style="color:#F8F8F8">100</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe)</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  };</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> mockStartTicker(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> onTick) {</span></span>
<span class="line"><span style="color:#6B737C">  // Simulate periodic ticks</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> interval</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> setInterval(() </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">    onTick({</span></span>
<span class="line"><span style="color:#B392F0">      timestamp</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Date</span><span style="color:#B392F0">.now()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      price</span><span style="color:#F97583">:</span><span style="color:#F8F8F8"> 50000</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.random() </span><span style="color:#F97583">*</span><span style="color:#F8F8F8"> 1000</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      volume</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.random() </span><span style="color:#F97583">*</span><span style="color:#F8F8F8"> 10</span></span>
<span class="line"><span style="color:#B392F0">    });</span></span>
<span class="line"><span style="color:#B392F0">  }</span><span style="color:#BBBBBB">,</span><span style="color:#F8F8F8"> 1000</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> interval;</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> mockStopTicker(interval) {</span></span>
<span class="line"><span style="color:#B392F0">  clearInterval(interval);</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> generateMockCandles(count</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> startTime</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> candles</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> [];</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#B392F0"> time </span><span style="color:#F97583">=</span><span style="color:#B392F0"> startTime;</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#B392F0"> price </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 50000</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  for</span><span style="color:#B392F0"> (</span><span style="color:#F97583">let</span><span style="color:#B392F0"> i </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 0</span><span style="color:#B392F0">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#B392F0"> count; i</span><span style="color:#F97583">++</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> open</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> price;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> change</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">Math</span><span style="color:#B392F0">.random() </span><span style="color:#F97583">-</span><span style="color:#F8F8F8"> 0.5</span><span style="color:#B392F0">) </span><span style="color:#F97583">*</span><span style="color:#F8F8F8"> 1000</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> close</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> open </span><span style="color:#F97583">+</span><span style="color:#B392F0"> change;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> high</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.max(open</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> close) </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.random() </span><span style="color:#F97583">*</span><span style="color:#F8F8F8"> 500</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> low</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.min(open</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> close) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.random() </span><span style="color:#F97583">*</span><span style="color:#F8F8F8"> 500</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> volume</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Math</span><span style="color:#B392F0">.random() </span><span style="color:#F97583">*</span><span style="color:#F8F8F8"> 100</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#79B8FF">    candles</span><span style="color:#B392F0">.push([time</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> open</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> high</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> low</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> close</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> volume]);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#B392F0">    time </span><span style="color:#F97583">+=</span><span style="color:#B392F0"> timeframe;</span></span>
<span class="line"><span style="color:#B392F0">    price </span><span style="color:#F97583">=</span><span style="color:#B392F0"> close;</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> candles;</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">## Troubleshooting Guide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### Common Issues</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">#### 1. Data Not Loading</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Symptoms:**</span></span>
<span class="line"><span style="color:#FFAB70">- Chart appears empty</span></span>
<span class="line"><span style="color:#FFAB70">- No error messages</span></span>
<span class="line"><span style="color:#FFAB70">- Network requests not being made</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Diagnosis:**</span></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">// Check DataSource configuration</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'DataSource config:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.cfg);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Symbol:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.symbol);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'TimeFrame:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.timeFrameStr);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'State active:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">state</span><span style="color:#B392F0">.isActive);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Check if history functions are registered</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Range limit handlers:'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  past</span><span style="color:#F97583">:</span><span style="color:#F97583"> typeof</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">source</span><span style="color:#B392F0">.rangeLimitPast</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  future</span><span style="color:#F97583">:</span><span style="color:#F97583"> typeof</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">source</span><span style="color:#B392F0">.rangeLimitFuture</span></span>
<span class="line"><span style="color:#B392F0">});</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Solutions:**</span></span>
<span class="line"><span style="color:#FFAB70">- Verify symbol and timeframe are valid</span></span>
<span class="line"><span style="color:#FFAB70">- Ensure history fetch functions are properly registered</span></span>
<span class="line"><span style="color:#FFAB70">- Check network connectivity and API endpoints</span></span>
<span class="line"><span style="color:#FFAB70">- Verify state is active and not empty</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">#### 2. Real-time Updates Not Working</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Symptoms:**</span></span>
<span class="line"><span style="color:#FFAB70">- Historical data loads but no live updates</span></span>
<span class="line"><span style="color:#FFAB70">- WebSocket connection issues</span></span>
<span class="line"><span style="color:#FFAB70">- Ticker stream errors</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Diagnosis:**</span></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">// Check stream status</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Stream active:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">stream</span><span style="color:#B392F0">.isActive);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Ticker functions:'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">  start</span><span style="color:#F97583">:</span><span style="color:#F97583"> typeof</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">source</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">tickerStream</span><span style="color:#B392F0">.start</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">  stop</span><span style="color:#F97583">:</span><span style="color:#F97583"> typeof</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">source</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">tickerStream</span><span style="color:#B392F0">.stop</span></span>
<span class="line"><span style="color:#B392F0">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Monitor WebSocket connection</span></span>
<span class="line"><span style="color:#79B8FF">dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">source</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">tickerStream</span><span style="color:#B392F0">.start </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> onTick) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">  console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">`Starting ticker for </span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#F97583"> ${</span><span style="color:#B392F0">tf</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> ws</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> WebSocket(</span><span style="color:#FFAB70">`wss://api.example.com/stream/</span><span style="color:#F97583">${</span><span style="color:#B392F0">symbol</span><span style="color:#F97583">}</span><span style="color:#FFAB70">/</span><span style="color:#F97583">${</span><span style="color:#B392F0">tf</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#79B8FF">  ws</span><span style="color:#B392F0">.onopen </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'WebSocket connected'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#79B8FF">  ws</span><span style="color:#B392F0">.onclose </span><span style="color:#F97583">=</span><span style="color:#B392F0"> () </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'WebSocket disconnected'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#79B8FF">  ws</span><span style="color:#B392F0">.onerror </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (error) </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> console</span><span style="color:#B392F0">.error(</span><span style="color:#FFAB70">'WebSocket error:'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> error);</span></span>
<span class="line"><span style="color:#79B8FF">  ws</span><span style="color:#B392F0">.onmessage </span><span style="color:#F97583">=</span><span style="color:#B392F0"> (event) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#79B8FF">    console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Received tick:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> event</span><span style="color:#B392F0">.data);</span></span>
<span class="line"><span style="color:#B392F0">    onTick(</span><span style="color:#79B8FF">JSON</span><span style="color:#B392F0">.parse(</span><span style="color:#79B8FF">event</span><span style="color:#B392F0">.data));</span></span>
<span class="line"><span style="color:#B392F0">  };</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> ws;</span></span>
<span class="line"><span style="color:#B392F0">};</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Solutions:**</span></span>
<span class="line"><span style="color:#FFAB70">- Verify WebSocket URL and connection parameters</span></span>
<span class="line"><span style="color:#FFAB70">- Check if ticker start/stop functions are properly implemented</span></span>
<span class="line"><span style="color:#FFAB70">- Ensure onTick callback is being called with correct data format</span></span>
<span class="line"><span style="color:#FFAB70">- Verify firewall/proxy settings allow WebSocket connections</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">#### 3. Memory Leaks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Symptoms:**</span></span>
<span class="line"><span style="color:#FFAB70">- Browser memory usage increases over time</span></span>
<span class="line"><span style="color:#FFAB70">- Performance degradation</span></span>
<span class="line"><span style="color:#FFAB70">- Browser becomes unresponsive</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Diagnosis:**</span></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">// Monitor DataSource instances</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Active DataSources:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.list().</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Memory usage:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> performance</span><span style="color:#B392F0">.memory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Check for unclosed streams</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> activeStreams</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> Array</span><span style="color:#B392F0">.from(</span><span style="color:#79B8FF">DataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">#sourceList</span><span style="color:#B392F0">.values())</span></span>
<span class="line"><span style="color:#B392F0">  .filter(ds </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> ds</span><span style="color:#B392F0">.stream </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#79B8FF"> ds</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">stream</span><span style="color:#B392F0">.isActive);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Active streams:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> activeStreams</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Solutions:**</span></span>
<span class="line"><span style="color:#FFAB70">- Always call `</span><span style="color:#79B8FF">DataSource</span><span style="color:#B392F0">.delete()</span><span style="color:#FFAB70">` when removing charts</span></span>
<span class="line"><span style="color:#FFAB70">- Ensure WebSocket connections are properly closed</span></span>
<span class="line"><span style="color:#FFAB70">- Remove event listeners when switching timeframes</span></span>
<span class="line"><span style="color:#FFAB70">- Implement proper cleanup in custom data providers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">#### 4. Performance Issues</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Symptoms:**</span></span>
<span class="line"><span style="color:#FFAB70">- Slow chart rendering</span></span>
<span class="line"><span style="color:#FFAB70">- Delayed data updates</span></span>
<span class="line"><span style="color:#FFAB70">- High CPU usage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Diagnosis:**</span></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">// Monitor fetch performance</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> metrics</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> DataSourceMetrics(dataSource);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Performance metrics:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> metrics</span><span style="color:#B392F0">.generateReport());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6B737C">// Check data volume</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Data points:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">state</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">length</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#79B8FF">console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Update frequency:'</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> dataSource</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">stream</span><span style="color:#B392F0">.tickRate);</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">**Solutions:**</span></span>
<span class="line"><span style="color:#FFAB70">- Implement data pagination for large datasets</span></span>
<span class="line"><span style="color:#FFAB70">- Use appropriate timeframes for chart resolution</span></span>
<span class="line"><span style="color:#FFAB70">- Enable data compression for network requests</span></span>
<span class="line"><span style="color:#FFAB70">- Implement efficient caching strategies</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### Debug Mode</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">Enable comprehensive debugging:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> DebugDataSource </span><span style="color:#F97583">extends</span><span style="color:#B392F0"> DataSource {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(cfg</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state) {</span></span>
<span class="line"><span style="color:#B392F0">    super(cfg</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state);</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.debug </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.debugLog </span><span style="color:#F97583">=</span><span style="color:#B392F0"> [];</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  log(message</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> data </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> null</span><span style="color:#B392F0">) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.debug) {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> entry</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">        timestamp</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Date</span><span style="color:#B392F0">.now()</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        message</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        data</span><span style="color:#F97583">:</span><span style="color:#B392F0"> data </span><span style="color:#F97583">?</span><span style="color:#79B8FF"> JSON</span><span style="color:#B392F0">.stringify(data) </span><span style="color:#F97583">:</span><span style="color:#79B8FF"> null</span></span>
<span class="line"><span style="color:#B392F0">      };</span></span>
<span class="line"><span style="color:#79B8FF">      this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">debugLog</span><span style="color:#B392F0">.push(entry);</span></span>
<span class="line"><span style="color:#79B8FF">      console</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">`[DataSource </span><span style="color:#F97583">${</span><span style="color:#79B8FF">this</span><span style="color:#B392F0">.id</span><span style="color:#F97583">}</span><span style="color:#FFAB70">] </span><span style="color:#F97583">${</span><span style="color:#B392F0">message</span><span style="color:#F97583">}</span><span style="color:#FFAB70">`</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> data);</span></span>
<span class="line"><span style="color:#B392F0">    }</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  timeFrameUse(tf) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Switching timeframe'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> { from</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.timeFrameStr</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> to</span><span style="color:#F97583">:</span><span style="color:#B392F0"> tf });</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> super.timeFrameUse(tf);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  tickerStart(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Starting ticker'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> { symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf });</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> super.tickerStart(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> tf);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  onRangeLimit(event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> fn</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#B392F0">.log(</span><span style="color:#FFAB70">'Range limit triggered'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> { event</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> event</span><span style="color:#B392F0">.type</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp });</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> super.onRangeLimit(event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> fn</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  getDebugInfo() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      id</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.id</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      symbol</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.symbol</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      timeFrame</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.timeFrameStr</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      state</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">state</span><span style="color:#B392F0">.key</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      streamActive</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">stream</span><span style="color:#B392F0">?.isActive </span><span style="color:#F97583">||</span><span style="color:#79B8FF"> false</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      dataPoints</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">state</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">?.</span><span style="color:#79B8FF">chart</span><span style="color:#B392F0">?.</span><span style="color:#79B8FF">data</span><span style="color:#B392F0">?.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ||</span><span style="color:#F8F8F8"> 0</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      debugLog</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">debugLog</span><span style="color:#B392F0">.slice(</span><span style="color:#F97583">-</span><span style="color:#F8F8F8">50</span><span style="color:#B392F0">) </span><span style="color:#6B737C">// Last 50 entries</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">## Migration Guide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### From Version 1.x to 2.x</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">#### Breaking Changes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">1. **Constructor Parameters**</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">   // Old (v1.x)</span></span>
<span class="line"><span style="color:#F97583">   const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> DataSource(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> config);</span></span>
<span class="line"><span style="color:#B392F0">   </span></span>
<span class="line"><span style="color:#6B737C">   // New (v2.x)</span></span>
<span class="line"><span style="color:#F97583">   const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">     symbol</span><span style="color:#F97583">:</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">     timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">     source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> config</span></span>
<span class="line"><span style="color:#B392F0">   }</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> state);</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">2. **Event Handler Signatures**</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">   // Old (v1.x)</span></span>
<span class="line"><span style="color:#B392F0">   rangeLimitPast</span><span style="color:#BBBBBB">:</span><span style="color:#B392F0"> (timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> fetchData(timestamp)</span></span>
<span class="line"><span style="color:#B392F0">   </span></span>
<span class="line"><span style="color:#6B737C">   // New (v2.x)</span></span>
<span class="line"><span style="color:#B392F0">   rangeLimitPast</span><span style="color:#BBBBBB">:</span><span style="color:#B392F0"> (event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> fetchData(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp)</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">3. **TimeFrame Format**</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">   // Old (v1.x) - String only</span></span>
<span class="line"><span style="color:#79B8FF">   dataSource</span><span style="color:#B392F0">.setTimeFrame(</span><span style="color:#FFAB70">'1h'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">   </span></span>
<span class="line"><span style="color:#6B737C">   // New (v2.x) - String or milliseconds</span></span>
<span class="line"><span style="color:#79B8FF">   dataSource</span><span style="color:#B392F0">.timeFrame </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> '1h'</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#79B8FF">   dataSource</span><span style="color:#B392F0">.timeFrame </span><span style="color:#F97583">=</span><span style="color:#F8F8F8"> 3600000</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">#### Migration Steps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">1. **Update DataSource Creation**</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">   // Before</span></span>
<span class="line"><span style="color:#F97583">   const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> DataSource(</span><span style="color:#FFAB70">'BTC/USDT'</span><span style="color:#BBBBBB">,</span><span style="color:#FFAB70"> '1h'</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">     fetchHistory</span><span style="color:#F97583">:</span><span style="color:#B392F0"> fetchFunction</span></span>
<span class="line"><span style="color:#B392F0">   });</span></span>
<span class="line"><span style="color:#B392F0">   </span></span>
<span class="line"><span style="color:#6B737C">   // After</span></span>
<span class="line"><span style="color:#F97583">   const</span><span style="color:#79B8FF"> dataSource</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create({</span></span>
<span class="line"><span style="color:#B392F0">     symbol</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'BTC/USDT'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">     timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> '1h'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">     source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">       name</span><span style="color:#F97583">:</span><span style="color:#FFAB70"> 'myExchange'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">       rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#B392F0"> fetchFunction</span></span>
<span class="line"><span style="color:#B392F0">     }</span></span>
<span class="line"><span style="color:#B392F0">   }</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> chartState);</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">2. **Update Event Handlers**</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">   // Before</span></span>
<span class="line"><span style="color:#F97583">   const</span><span style="color:#B392F0"> fetchHistory </span><span style="color:#F97583">=</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> (timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">     return</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> api</span><span style="color:#B392F0">.getCandles(timestamp);</span></span>
<span class="line"><span style="color:#B392F0">   };</span></span>
<span class="line"><span style="color:#B392F0">   </span></span>
<span class="line"><span style="color:#6B737C">   // After</span></span>
<span class="line"><span style="color:#F97583">   const</span><span style="color:#B392F0"> fetchHistory </span><span style="color:#F97583">=</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> (event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#F97583">     return</span><span style="color:#F97583"> await</span><span style="color:#79B8FF"> api</span><span style="color:#B392F0">.getCandles(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp);</span></span>
<span class="line"><span style="color:#B392F0">   };</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">3. **Update Stream Handlers**</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#6B737C">   // Before</span></span>
<span class="line"><span style="color:#79B8FF">   dataSource</span><span style="color:#B392F0">.setStream(startFunction</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> stopFunction);</span></span>
<span class="line"><span style="color:#B392F0">   </span></span>
<span class="line"><span style="color:#6B737C">   // After</span></span>
<span class="line"><span style="color:#79B8FF">   dataSource</span><span style="color:#B392F0">.tickerAdd({</span></span>
<span class="line"><span style="color:#B392F0">     start</span><span style="color:#F97583">:</span><span style="color:#B392F0"> startFunction</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">     stop</span><span style="color:#F97583">:</span><span style="color:#B392F0"> stopFunction</span></span>
<span class="line"><span style="color:#B392F0">   });</span></span>
<span class="line"><span style="color:#FFAB70">   ```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">### Compatibility Layer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">For gradual migration, use this compatibility wrapper:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">```</span><span style="color:#B392F0">javascript</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> LegacyDataSource {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#B392F0">(symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> config) {</span></span>
<span class="line"><span style="color:#79B8FF">    console</span><span style="color:#B392F0">.warn(</span><span style="color:#FFAB70">'LegacyDataSource is deprecated. Use DataSource.create() instead.'</span><span style="color:#B392F0">);</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#6B737C">    // Convert old format to new format</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> newConfig</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">      symbol</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      timeFrameInit</span><span style="color:#F97583">:</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">      source</span><span style="color:#F97583">:</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">        name</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> config</span><span style="color:#B392F0">.name </span><span style="color:#F97583">||</span><span style="color:#FFAB70"> 'legacy'</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        rangeLimitPast</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#B392F0">.wrapLegacyFunction(</span><span style="color:#79B8FF">config</span><span style="color:#B392F0">.fetchHistory)</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">        tickerStream</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> config</span><span style="color:#B392F0">.stream </span><span style="color:#F97583">?</span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#B392F0">          start</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> config</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">stream</span><span style="color:#B392F0">.start</span><span style="color:#BBBBBB">,</span></span>
<span class="line"><span style="color:#B392F0">          stop</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> config</span><span style="color:#B392F0">.</span><span style="color:#79B8FF">stream</span><span style="color:#B392F0">.stop</span></span>
<span class="line"><span style="color:#B392F0">        } </span><span style="color:#F97583">:</span><span style="color:#79B8FF"> undefined</span></span>
<span class="line"><span style="color:#B392F0">      }</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> DataSource</span><span style="color:#B392F0">.create(newConfig</span><span style="color:#BBBBBB">,</span><span style="color:#79B8FF"> config</span><span style="color:#B392F0">.state);</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">  </span></span>
<span class="line"><span style="color:#B392F0">  wrapLegacyFunction(legacyFn) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#B392F0"> (</span><span style="color:#F97583">!</span><span style="color:#B392F0">legacyFn) </span><span style="color:#F97583">return</span><span style="color:#79B8FF"> undefined</span><span style="color:#B392F0">;</span></span>
<span class="line"><span style="color:#B392F0">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> (event</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> symbol</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timeframe</span><span style="color:#BBBBBB">,</span><span style="color:#B392F0"> timestamp) </span><span style="color:#F97583">=></span><span style="color:#B392F0"> {</span></span>
<span class="line"><span style="color:#6B737C">      // Call legacy function with old signature</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#B392F0"> legacyFn(timestamp);</span></span>
<span class="line"><span style="color:#B392F0">    };</span></span>
<span class="line"><span style="color:#B392F0">  }</span></span>
<span class="line"><span style="color:#B392F0">}</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">## Conclusion</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">The DataSource class provides a comprehensive solution for managing financial data in TradeX charts. Its pull-based architecture, flexible configuration options, and robust error handling make it suitable for a wide range of trading applications.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">Key benefits:</span></span>
<span class="line"><span style="color:#FFAB70">- **Agnostic Design**: Works with any data provider or exchange</span></span>
<span class="line"><span style="color:#FFAB70">- **Efficient State Management**: Automatic state switching and data sharing</span></span>
<span class="line"><span style="color:#FFAB70">- **Real-time Capabilities**: Seamless integration of live data streams</span></span>
<span class="line"><span style="color:#FFAB70">- **Performance Optimized**: Built-in caching, batching, and prefetching</span></span>
<span class="line"><span style="color:#FFAB70">- **Developer Friendly**: Comprehensive error handling and debugging tools</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">For additional support or advanced use cases, refer to the TradeX documentation or community resources.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">## Related Documentation</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">- [TradeXChart Core API](./TradeXChart.md)</span></span>
<span class="line"><span style="color:#FFAB70">- [State Management](./State.md)</span></span>
<span class="line"><span style="color:#FFAB70">- [Stream Processing](./Stream.md)</span></span>
<span class="line"><span style="color:#FFAB70">- [Range Management](./Range.md)</span></span>
<span class="line"><span style="color:#FFAB70">- [Event System](./Events.md)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">## Version History</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">- **v2.1.0**: Added multi-exchange support and performance monitoring</span></span>
<span class="line"><span style="color:#FFAB70">- **v2.0.0**: Major refactor with pull-based architecture</span></span>
<span class="line"><span style="color:#FFAB70">- **v1.5.0**: Added WebSocket streaming support</span></span>
<span class="line"><span style="color:#FFAB70">- **v1.0.0**: Initial release with basic data management</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">*Last updated: 2024*</span></span>
<span class="line"><span style="color:#FFAB70">*Documentation version: 2.1.0*</span></span>
<span class="line"><span style="color:#FFAB70">```</span></span></code></pre></div><footer class="astro-3yyafb3n"><div class="meta sl-flex astro-3yyafb3n"></div><div class="pagination-links sl-flex astro-u2l5gyhi" dir="ltr"><a href="/TradeX-chart/reference/changelog/" rel="prev" class="astro-u2l5gyhi"><svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg><span class="astro-u2l5gyhi">Previous<br class="astro-u2l5gyhi"><span class="link-title astro-u2l5gyhi">Changelog</span></span></a><a href="/TradeX-chart/reference/events/" rel="next" class="astro-u2l5gyhi"><svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg><span class="astro-u2l5gyhi">Next<br class="astro-u2l5gyhi"><span class="link-title astro-u2l5gyhi">Events</span></span></a></div></footer></div></div></main></div></div></div></div></body></html>